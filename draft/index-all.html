<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªåª’ä½“å·¥å…·é›† - é™éŸ³ç‰‡æ®µè¿‡æ»¤å·¥å…·</title>
    <style>
        /* CSSå˜é‡å®šä¹‰ */
:root {
    --color--foreground-fg--fg-base-88: #000000e0;
    --color--foreground-fg--fg-link: #1a4be1;
    --color--foreground-fg--fg-link-hover: #1a40ca;
    --color--foreground-fg--fg-base-65: #000000a6;
    --color--background-bg--bg-gray-gray: #f3f4f6;
    --color--border--neutralbold: #8995a7;
    --color--foreground-fg--fg-base: black;
    --color--background-bg--bg-black: #01091b;
    --color--accent--accent-solid: #cf163e;
    --color--accent--accent-solid-hover: #9c102e;
    --color--foreground-fg--fg-oncontrast: #fff;
    --color--border--accentminimal: #ffe3e5;
    --color--border--accentbold: #ffa1ac;
    --color--border--gray-secondary: #e5e7eb;
    --color--foreground-fg--fg-accent: #cf163e;
    --color--background-bg--bg-gray: #f8f8f8;
    --color--border--neutralsuble: #d6dae1;
    --color--background-bg--bg-white: white;
    --color--background-bg--bg-subtle: #fff1f2;
    --color--border--accentsubtle: #ffcbd2;
    --color--border--neutralminimal: #fcfcfc;
    --color--foreground-fg--fg-disabled: #b5b5b5;
    --color--foreground-fg--fg-placeholder: #b5b5b5;
    --radius--8px: 8px;
    --radius--4px: 4px;
    --radius--12px: 12px;
    --radius--16px: 16px;
    --empty-space--64px: 64px;
    --empty-space--48px: 48px;
    --empty-space--32px: 32px;
    --empty-space--24px: 24px;
    --empty-space--16px: 16px;
}

/* é‡ç½®æ ·å¼ */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: Geist, Arial, sans-serif;
    line-height: 1.6;
    color: var(--color--foreground-fg--fg-base-88);
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
    min-height: 100vh;
    font-size: 16px;
    font-weight: 400;
}

.container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0 40px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

/* æ ‡é¢˜æ ·å¼ */
h1 {
    font-family: Satoshi, Arial, sans-serif;
    font-size: 72px;
    margin-top: 20px;
    margin-bottom: 10px;
    font-weight: 700;
    line-height: 1.1em;
}

h2 {
    font-family: Satoshi, Arial, sans-serif;
    font-size: 56px;
    margin-top: 20px;
    margin-bottom: 10px;
    font-weight: 700;
    line-height: 1.17em;
}

h3 {
    font-family: Satoshi, Arial, sans-serif;
    font-size: 36px;
    margin-top: 20px;
    margin-bottom: 10px;
    font-weight: 700;
    line-height: 1.27em;
}

h4 {
    font-family: Satoshi, Arial, sans-serif;
    font-size: 28px;
    margin-top: 10px;
    margin-bottom: 10px;
    font-weight: 700;
    line-height: 1.28em;
}

h5 {
    font-family: Satoshi, Arial, sans-serif;
    font-size: 22px;
    margin-top: 10px;
    margin-bottom: 10px;
    font-weight: 700;
    line-height: 1.27em;
}

h6 {
    font-family: Satoshi, Arial, sans-serif;
    font-size: 18px;
    margin-top: 10px;
    margin-bottom: 10px;
    font-weight: 700;
    line-height: 1.33em;
}

p {
    font-size: 16px;
    margin-bottom: 10px;
    line-height: 1.6em;
}

a {
    color: var(--color--foreground-fg--fg-link);
    text-decoration: none;
}

a:hover {
    color: var(--color--foreground-fg--fg-link-hover);
}

/* å¤´éƒ¨æ ·å¼ */
.header {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: var(--radius--16px);
    padding: 24px 32px;
    margin-bottom: 32px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo h1 {
    font-size: 2em;
    font-weight: 700;
    color: var(--color--accent--accent-solid);
    margin-bottom: 4px;
}

.logo p {
    color: var(--color--foreground-fg--fg-base-65);
    font-size: 0.9em;
}

.nav {
    display: flex;
    gap: 16px;
}

.nav-item {
    padding: 12px 24px;
    border-radius: var(--radius--8px);
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
    font-family: Satoshi, Arial, sans-serif;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    font-size: 12px;
}

.nav-item.active {
    background: var(--color--accent--accent-solid);
    color: white;
}

.nav-item.disabled {
    color: var(--color--foreground-fg--fg-disabled);
    cursor: not-allowed;
}

/* ä¸»å†…å®¹åŒºåŸŸ */
.main {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 32px;
}

/* å·¥å…·æ ‡é¢˜åŒº */
.tool-header {
    text-align: center;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: var(--radius--16px);
    padding: 48px 32px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.tool-header h2 {
    font-size: 56px;
    font-weight: 700;
    color: var(--color--foreground-fg--fg-base);
    margin-bottom: 12px;
}

.tool-header p {
    font-size: 18px;
    color: var(--color--foreground-fg--fg-base-65);
    line-height: 1.55em;
}

/* å¡ç‰‡é€šç”¨æ ·å¼ */
.section {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: var(--radius--16px);
    padding: 32px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    margin-bottom: 24px;
}

/* æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ */
.upload-section {
    position: relative;
}

.upload-area {
    border: 3px dashed var(--color--border--neutralbold);
    border-radius: var(--radius--12px);
    padding: 48px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: var(--color--background-bg--bg-gray);
    position: relative;
    overflow: hidden;
}

.upload-area::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    transition: left 0.5s;
}

.upload-area:hover::before {
    left: 100%;
}

.upload-area:hover {
    border-color: var(--color--accent--accent-solid);
    background: var(--color--border--accentminimal);
    transform: translateY(-2px);
    box-shadow: 0 12px 40px rgba(207, 22, 62, 0.15);
}

.upload-area.dragover {
    border-color: var(--color--accent--accent-solid);
    background: var(--color--border--accentminimal);
    transform: scale(1.02);
    box-shadow: 0 16px 48px rgba(207, 22, 62, 0.2);
}

.upload-icon {
    font-size: 4em;
    margin-bottom: 16px;
    filter: grayscale(1);
    transition: filter 0.3s ease;
}

.upload-area:hover .upload-icon {
    filter: grayscale(0);
}

.upload-area h3 {
    font-size: 24px;
    margin-bottom: 8px;
    color: var(--color--foreground-fg--fg-base);
    font-weight: 700;
}

.upload-area p {
    color: var(--color--foreground-fg--fg-base-65);
    margin-bottom: 24px;
    font-size: 16px;
}

.upload-btn {
    background: var(--color--accent--accent-solid);
    color: white;
    border: none;
    padding: 16px 32px;
    border-radius: var(--radius--8px);
    font-size: 1em;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    font-family: Satoshi, Arial, sans-serif;
    font-size: 12px;
}

.upload-btn:hover {
    background: var(--color--accent--accent-solid-hover);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(207, 22, 62, 0.3);
}

/* æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º */
.file-info {
    margin-top: 24px;
    padding: 24px;
    background: var(--color--border--accentminimal);
    border-radius: var(--radius--12px);
    border: 1px solid var(--color--border--accentsubtle);
}

.file-details {
    display: flex;
    gap: 24px;
    margin-bottom: 16px;
    flex-wrap: wrap;
}

.file-name {
    font-weight: 600;
    color: var(--color--accent--accent-solid);
}

.file-size,
.file-duration {
    color: var(--color--foreground-fg--fg-base-65);
}

.upload-progress {
    display: flex;
    align-items: center;
    gap: 16px;
}

.progress-bar {
    flex: 1;
    height: 8px;
    background: var(--color--border--accentsubtle);
    border-radius: 4px;
    overflow: hidden;
    position: relative;
}

.progress-bar::after {
    content: '';
    display: block;
    height: 100%;
    background: var(--color--accent--accent-solid);
    width: 0%;
    transition: width 0.3s ease;
}

.progress-text {
    font-weight: 600;
    color: var(--color--accent--accent-solid);
    min-width: 40px;
}

/* å‚æ•°é…ç½®åŒºåŸŸ */
.config-section h3 {
    font-size: 28px;
    margin-bottom: 24px;
    color: var(--color--foreground-fg--fg-base);
}

/* é¢„è®¾æ¡£ä½ */
.preset-modes {
    margin-bottom: 32px;
}

.preset-modes h4 {
    font-size: 20px;
    margin-bottom: 16px;
    color: var(--color--foreground-fg--fg-base);
}

.mode-buttons {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 12px;
    margin-bottom: 12px;
}

.mode-btn {
    padding: 16px 24px;
    border: 2px solid var(--color--border--gray-secondary);
    background: white;
    border-radius: var(--radius--8px);
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
    text-align: center;
    font-family: Satoshi, Arial, sans-serif;
}

.mode-btn:hover {
    border-color: var(--color--accent--accent-solid);
    background: var(--color--border--accentminimal);
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(207, 22, 62, 0.1);
}

.mode-btn.active {
    border-color: var(--color--accent--accent-solid);
    background: var(--color--accent--accent-solid);
    color: white;
    box-shadow: 0 8px 24px rgba(207, 22, 62, 0.3);
}

.mode-description {
    color: var(--color--foreground-fg--fg-base-65);
    font-style: italic;
    text-align: center;
    padding: 12px;
    background: var(--color--background-bg--bg-gray);
    border-radius: var(--radius--8px);
    margin-top: 12px;
}

/* å‚æ•°æ§åˆ¶ */
.parameters {
    display: grid;
    gap: 32px;
}

.param-group {
    display: grid;
    gap: 12px;
}

.param-group label {
    font-weight: 600;
    color: var(--color--foreground-fg--fg-base);
    font-size: 16px;
    font-family: Satoshi, Arial, sans-serif;
}

.param-control {
    display: flex;
    align-items: center;
    gap: 16px;
    background: var(--color--background-bg--bg-gray);
    padding: 16px;
    border-radius: var(--radius--8px);
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.param-control:hover {
    border-color: var(--color--border--accentsubtle);
    background: var(--color--border--accentminimal);
}

.param-control input[type="range"] {
    flex: 1;
    height: 6px;
    background: var(--color--border--gray-secondary);
    border-radius: 3px;
    outline: none;
    -webkit-appearance: none;
    cursor: pointer;
}

.param-control input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 20px;
    height: 20px;
    background: var(--color--accent--accent-solid);
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(207, 22, 62, 0.3);
    transition: all 0.3s ease;
}

.param-control input[type="range"]::-webkit-slider-thumb:hover {
    transform: scale(1.2);
    box-shadow: 0 4px 16px rgba(207, 22, 62, 0.5);
}

.param-control input[type="number"] {
    width: 80px;
    padding: 8px 12px;
    border: 2px solid var(--color--border--gray-secondary);
    border-radius: var(--radius--4px);
    font-size: 0.9em;
    text-align: center;
    background: white;
    transition: border-color 0.3s ease;
}

.param-control input[type="number"]:focus {
    outline: none;
    border-color: var(--color--accent--accent-solid);
}

.param-unit {
    color: var(--color--foreground-fg--fg-base-65);
    font-weight: 500;
    min-width: 40px;
}

.param-tip {
    color: var(--color--foreground-fg--fg-base-65);
    font-size: 0.9em;
    margin-top: 4px;
    font-style: italic;
}

/* é«˜çº§å‚æ•° */
.advanced-params {
    margin-top: 32px;
    border-top: 1px solid var(--color--border--gray-secondary);
    padding-top: 24px;
}

.advanced-params h4 {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
    color: var(--color--foreground-fg--fg-base);
}

.toggle-btn {
    background: var(--color--background-bg--bg-gray);
    border: none;
    padding: 8px 16px;
    border-radius: var(--radius--8px);
    cursor: pointer;
    font-size: 0.9em;
    transition: all 0.3s ease;
    font-family: Satoshi, Arial, sans-serif;
    font-weight: 500;
}

.toggle-btn:hover {
    background: var(--color--border--accentminimal);
    color: var(--color--accent--accent-solid);
}

.advanced-content {
    display: grid;
    gap: 24px;
}

/* æ³¢å½¢æ˜¾ç¤ºåŒºåŸŸ */
.waveform-section h3 {
    font-size: 28px;
    margin-bottom: 24px;
    color: var(--color--foreground-fg--fg-base);
}

.waveform-container {
    display: grid;
    gap: 16px;
}

.waveform-controls {
    display: flex;
    align-items: center;
    gap: 16px;
    flex-wrap: wrap;
    padding: 16px;
    background: var(--color--background-bg--bg-gray);
    border-radius: var(--radius--8px);
}

.control-btn,
.tool-btn {
    padding: 12px 20px;
    border: 2px solid var(--color--border--gray-secondary);
    background: white;
    border-radius: var(--radius--8px);
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
    font-family: Satoshi, Arial, sans-serif;
}

.control-btn:hover,
.tool-btn:hover {
    border-color: var(--color--accent--accent-solid);
    background: var(--color--border--accentminimal);
    transform: translateY(-2px);
}

.control-btn.active,
.tool-btn.active {
    border-color: var(--color--accent--accent-solid);
    background: var(--color--accent--accent-solid);
    color: white;
}

.time-display {
    color: var(--color--foreground-fg--fg-base-65);
    font-weight: 600;
    margin-left: auto;
    font-family: 'Monaco', 'Menlo', monospace;
}

/* æ³¢å½¢ç”»å¸ƒå®¹å™¨ */
.waveform-canvas-container {
    position: relative;
    background: var(--color--background-bg--bg-gray);
    border: 2px solid var(--color--border--gray-secondary);
    border-radius: var(--radius--12px);
    overflow: hidden;
    box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);
}

#waveformCanvas {
    display: block;
    width: 100%;
    height: 200px;
    cursor: crosshair;
}

.threshold-line {
    position: absolute;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--color--accent--accent-solid);
    cursor: ns-resize;
    z-index: 10;
    border-radius: 2px;
    box-shadow: 0 2px 8px rgba(207, 22, 62, 0.3);
}

.threshold-line::before {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    top: -6px;
    bottom: -6px;
    background: rgba(207, 22, 62, 0.1);
    border-radius: 4px;
}

.playhead {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 2px;
    background: #22c55e;
    z-index: 5;
    pointer-events: none;
    box-shadow: 0 0 8px rgba(34, 197, 94, 0.5);
}

/* æ³¢å½¢å·¥å…·æ  */
.waveform-toolbar {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    padding: 16px;
    background: var(--color--background-bg--bg-gray);
    border-radius: var(--radius--8px);
}

/* ç‰‡æ®µä¿¡æ¯ */
.segments-info {
    background: var(--color--background-bg--bg-gray);
    border-radius: var(--radius--8px);
    padding: 20px;
}

.segment-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 24px;
}

.stat {
    color: var(--color--foreground-fg--fg-base-65);
    font-size: 0.9em;
    text-align: center;
    padding: 12px;
    background: white;
    border-radius: var(--radius--8px);
    border: 2px solid var(--color--border--gray-secondary);
}

.stat strong {
    color: var(--color--foreground-fg--fg-base);
    display: block;
    font-size: 1.5em;
    margin-bottom: 4px;
    font-family: Satoshi, Arial, sans-serif;
    font-weight: 700;
}

/* è¾“å‡ºåŒºåŸŸ */
.output-section h3,
.output-section h4 {
    color: var(--color--foreground-fg--fg-base);
    margin-bottom: 16px;
}

.output-section h3 {
    font-size: 28px;
    margin-bottom: 24px;
}

/* é¢„è§ˆåŒºåŸŸ */
.preview-area {
    margin-bottom: 32px;
    padding: 24px;
    background: var(--color--border--accentminimal);
    border-radius: var(--radius--12px);
    border: 2px solid var(--color--border--accentsubtle);
}

.preview-area h4 {
    color: var(--color--accent--accent-solid);
    margin-bottom: 8px;
}

.preview-area p {
    color: var(--color--foreground-fg--fg-base-65);
    margin-bottom: 16px;
}

.preview-btn {
    background: var(--color--accent--accent-solid);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: var(--radius--8px);
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    font-family: Satoshi, Arial, sans-serif;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    font-size: 12px;
}

.preview-btn:hover {
    background: var(--color--accent--accent-solid-hover);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(207, 22, 62, 0.3);
}

#previewAudio {
    margin-top: 16px;
    width: 100%;
    border-radius: var(--radius--8px);
}

/* è¾“å‡ºè®¾ç½® */
.output-settings {
    display: grid;
    gap: 20px;
    margin-bottom: 32px;
}

.setting-group {
    display: grid;
    gap: 8px;
}

.setting-group label {
    font-weight: 600;
    color: var(--color--foreground-fg--fg-base);
    font-family: Satoshi, Arial, sans-serif;
}

.setting-group select {
    padding: 12px 16px;
    border: 2px solid var(--color--border--gray-secondary);
    border-radius: var(--radius--8px);
    background: white;
    font-size: 1em;
    cursor: pointer;
    transition: all 0.3s ease;
}

.setting-group select:focus {
    outline: none;
    border-color: var(--color--accent--accent-solid);
    box-shadow: 0 0 0 3px rgba(207, 22, 62, 0.1);
}

/* å¤„ç†åŒºåŸŸ */
.process-area {
    text-align: center;
}

.process-btn {
    background: linear-gradient(135deg, var(--color--accent--accent-solid), var(--color--accent--accent-solid-hover));
    color: white;
    border: none;
    padding: 20px 48px;
    border-radius: var(--radius--12px);
    font-size: 1.2em;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 8px 32px rgba(207, 22, 62, 0.3);
    text-transform: uppercase;
    letter-spacing: 1.5px;
    font-family: Satoshi, Arial, sans-serif;
    font-size: 14px;
}

.process-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 40px rgba(207, 22, 62, 0.4);
}

.process-btn:disabled {
    background: var(--color--foreground-fg--fg-disabled);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

/* å¤„ç†çŠ¶æ€ */
.process-status {
    margin-top: 24px;
    padding: 24px;
    background: var(--color--background-bg--bg-gray);
    border-radius: var(--radius--12px);
    border: 2px solid var(--color--border--gray-secondary);
}

.process-progress {
    width: 100%;
    height: 12px;
    background: var(--color--border--gray-secondary);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 16px;
    position: relative;
}

.process-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--color--accent--accent-solid), var(--color--accent--accent-solid-hover));
    width: 0%;
    transition: width 0.3s ease;
    border-radius: 6px;
}

.process-text {
    font-weight: 600;
    color: var(--color--foreground-fg--fg-base);
    margin-bottom: 8px;
    font-family: Satoshi, Arial, sans-serif;
}

.process-eta {
    color: var(--color--foreground-fg--fg-base-65);
    font-size: 0.9em;
}

/* é¡µè„š */
.footer {
    text-align: center;
    margin-top: 48px;
    padding: 24px;
    color: var(--color--foreground-fg--fg-base-65);
    background: rgba(255, 255, 255, 0.5);
    backdrop-filter: blur(10px);
    border-radius: var(--radius--16px);
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 1024px) {
    .container {
        padding: 0 20px;
    }

    .tool-header h2 {
        font-size: 40px;
    }

    .mode-buttons {
        grid-template-columns: 1fr 1fr;
    }
}

@media (max-width: 768px) {
    .container {
        padding: 0 16px;
    }

    .header {
        flex-direction: column;
        gap: 16px;
        text-align: center;
    }

    .nav {
        justify-content: center;
    }

    .tool-header h2 {
        font-size: 32px;
    }

    .tool-header {
        padding: 32px 20px;
    }

    .section {
        padding: 24px 20px;
    }

    .upload-area {
        padding: 32px 16px;
    }

    .file-details {
        flex-direction: column;
        gap: 8px;
    }

    .mode-buttons {
        grid-template-columns: 1fr;
    }

    .param-control {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
    }

    .param-control input[type="number"] {
        width: 100%;
    }

    .waveform-controls,
    .waveform-toolbar {
        flex-direction: column;
    }

    .segment-stats {
        grid-template-columns: 1fr 1fr;
        gap: 16px;
    }

    .output-settings {
        gap: 16px;
    }

    h1 {
        font-size: 44px;
    }

    h2 {
        font-size: 40px;
    }

    h3 {
        font-size: 24px;
    }
}

@media (max-width: 480px) {
    .container {
        padding: 0 12px;
    }

    .tool-header h2 {
        font-size: 28px;
    }

    .segment-stats {
        grid-template-columns: 1fr;
    }

    .waveform-controls {
        padding: 12px;
    }

    .process-btn {
        padding: 16px 32px;
        font-size: 1em;
    }

    h1 {
        font-size: 36px;
    }

    h2 {
        font-size: 32px;
    }
}

/* åŠ¨ç”»æ•ˆæœ */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.config-section,
.waveform-section,
.output-section {
    animation: fadeIn 0.6s ease-out;
}

@keyframes pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}

.upload-area.dragover {
    animation: pulse 1s infinite;
}

/* è¿›åº¦æ¡åŠ¨ç”» */
@keyframes progressShine {
    0% {
        transform: translateX(-100%);
    }
    100% {
        transform: translateX(100%);
    }
}

.process-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    animation: progressShine 2s infinite;
}

/* å·¥å…·æç¤ºæ ·å¼ */
.tooltip {
    position: relative;
    cursor: help;
}

.tooltip::before {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    background: var(--color--background-bg--bg-black);
    color: white;
    padding: 8px 12px;
    border-radius: var(--radius--8px);
    font-size: 0.8em;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 1000;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
}

.tooltip:hover::before {
    opacity: 1;
}

/* é”™è¯¯å’ŒæˆåŠŸçŠ¶æ€ */
.error {
    border-color: #ef4444 !important;
    background: #fef2f2 !important;
}

.error-message {
    color: #dc2626;
    font-size: 0.9em;
    margin-top: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px;
    background: #fef2f2;
    border-radius: var(--radius--8px);
    border: 1px solid #fecaca;
}

.error-message::before {
    content: 'âš ï¸';
}

.success {
    border-color: #10b981 !important;
    background: #f0fdf4 !important;
}

.success-message {
    color: #059669;
    font-size: 0.9em;
    margin-top: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px;
    background: #f0fdf4;
    border-radius: var(--radius--8px);
    border: 1px solid #dcfce7;
}

.success-message::before {
    content: 'âœ…';
}

/* ç„¦ç‚¹æ ·å¼ */
*:focus {
    outline: 2px solid var(--color--accent--accent-solid);
    outline-offset: 2px;
}

/* é€‰æ‹©æ–‡æœ¬æ ·å¼ */
::selection {
    background: var(--color--border--accentsubtle);
    color: var(--color--accent--accent-solid);
}

/* æ»šåŠ¨æ¡æ ·å¼ */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: var(--color--background-bg--bg-gray);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: var(--color--border--neutralbold);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--color--accent--accent-solid);
}
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨å¯¼èˆª -->
        <header class="header">
            <div class="logo">
                <h1>è‡ªåª’ä½“å·¥å…·é›†</h1>
                <p>æå‡åˆ›ä½œæ•ˆç‡çš„æ™ºèƒ½å·¥å…·</p>
            </div>
            <nav class="nav">
                <span class="nav-item active">é™éŸ³ç‰‡æ®µè¿‡æ»¤</span>
                <span class="nav-item disabled">æ›´å¤šå·¥å…·</span>
            </nav>
        </header>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main">
            <!-- å·¥å…·æ ‡é¢˜åŒº -->
            <section class="tool-header">
                <h2>é™éŸ³ç‰‡æ®µè¿‡æ»¤å·¥å…·</h2>
                <p>æ™ºèƒ½è¯†åˆ«å¹¶å»é™¤è§†é¢‘ä¸­çš„é™éŸ³ç‰‡æ®µï¼Œæå‡å‰ªè¾‘æ•ˆç‡</p>
                <p>æœ¬ç½‘é¡µä»…åšåŸå‹å±•ç¤ºï¼Œç”±äºæ˜¯ä½¿ç”¨pythonè¯­è¨€å®ç°ï¼Œç›®å‰è¿˜ä¸æ”¯æŒæµè§ˆå™¨è®¿é—®ï¼Œå®Œæ•´çš„pythonè„šæœ¬åœ¨ï¼š 
                    <a href="https://github.com/samelltiger/taoge_media_edit" target="_blank">Githubä»“åº“åœ°å€</a>
                </p>
            </section>

            <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
            <section class="upload-section">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">ğŸ“</div>
                    <h3>æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </h3>
                    <p>æ”¯æŒæ ¼å¼ï¼šMP4, MOV, MP3, WAV, M4A</p>
                    <input type="file" id="fileInput" accept=".mp4,.mov,.mp3,.wav,.m4a" hidden>
                    <button class="upload-btn" onclick="document.getElementById('fileInput').click()">é€‰æ‹©æ–‡ä»¶</button>
                </div>

                <!-- æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º -->
                <div class="file-info" id="fileInfo" style="display: none;">
                    <div class="file-details">
                        <span class="file-name" id="fileName"></span>
                        <span class="file-size" id="fileSize"></span>
                        <span class="file-duration" id="fileDuration"></span>
                    </div>
                    <div class="upload-progress">
                        <div class="progress-bar" id="progressBar"></div>
                        <span class="progress-text" id="progressText">0%</span>
                    </div>
                </div>
            </section>

            <!-- å‚æ•°é…ç½®åŒºåŸŸ -->
            <section class="config-section" id="configSection" style="display: none;">
                <h3>å‚æ•°é…ç½®</h3>

                <!-- é¢„è®¾æ¡£ä½ -->
                <div class="preset-modes">
                    <h4>èŠ‚å¥æ¨¡å¼é¢„è®¾</h4>
                    <div class="mode-buttons">
                        <button class="mode-btn" data-mode="slow">æ…¢é€ŸèŠ‚å¥</button>
                        <button class="mode-btn active" data-mode="medium">ä¸­ç­‰èŠ‚å¥</button>
                        <button class="mode-btn" data-mode="fast">å¿«é€ŸèŠ‚å¥</button>
                        <button class="mode-btn" data-mode="custom">è‡ªå®šä¹‰</button>
                    </div>
                    <div class="mode-description">
                        <p id="modeDesc">é€‚ç”¨äºå¤§å¤šæ•°æ ‡å‡†å£æ’­è§†é¢‘</p>
                    </div>
                </div>

                <!-- æ ¸å¿ƒå‚æ•° -->
                <div class="parameters">
                    <div class="param-group">
                        <label for="silenceThreshold">é™éŸ³é˜ˆå€¼ (dB)</label>
                        <div class="param-control">
                            <input type="range" id="silenceThreshold" min="-60" max="-20" value="-40" step="1">
                            <input type="number" id="silenceThresholdValue" min="-60" max="-20" value="-40">
                            <span class="param-unit">dB</span>
                        </div>
                        <p class="param-tip">ä½äºæ­¤éŸ³é‡å€¼çš„ç‰‡æ®µå°†è¢«åˆ¤å®šä¸ºé™éŸ³</p>
                    </div>

                    <div class="param-group">
                        <label for="leadingPadding">å‰è¿‡æ¸¡ä¿ç•™ (ç§’)</label>
                        <div class="param-control">
                            <input type="range" id="leadingPadding" min="0" max="2" value="0.3" step="0.1">
                            <input type="number" id="leadingPaddingValue" min="0" max="2" value="0.3" step="0.1">
                            <span class="param-unit">ç§’</span>
                        </div>
                        <p class="param-tip">åœ¨æœ‰ç”¨ç‰‡æ®µå¼€å§‹å¤„é¢å¤–ä¿ç•™çš„æ—¶é—´</p>
                    </div>

                    <div class="param-group">
                        <label for="trailingPadding">åè¿‡æ¸¡ä¿ç•™ (ç§’)</label>
                        <div class="param-control">
                            <input type="range" id="trailingPadding" min="0" max="2" value="0.5" step="0.1">
                            <input type="number" id="trailingPaddingValue" min="0" max="2" value="0.5" step="0.1">
                            <span class="param-unit">ç§’</span>
                        </div>
                        <p class="param-tip">åœ¨æœ‰ç”¨ç‰‡æ®µç»“æŸå¤„é¢å¤–ä¿ç•™çš„æ—¶é—´</p>
                    </div>
                </div>

                <!-- é«˜çº§å‚æ•° -->
                <div class="advanced-params" id="advancedParams">
                    <h4>é«˜çº§å‚æ•° <button class="toggle-btn" id="toggleAdvanced">å±•å¼€</button></h4>
                    <div class="advanced-content" style="display: none;">
                        <div class="param-group">
                            <label for="minSilenceDuration">æœ€å°é™éŸ³æ—¶é•¿ (ç§’)</label>
                            <div class="param-control">
                                <input type="range" id="minSilenceDuration" min="0.1" max="2" value="0.3" step="0.1">
                                <input type="number" id="minSilenceDurationValue" min="0.1" max="2" value="0.3" step="0.1">
                                <span class="param-unit">ç§’</span>
                            </div>
                            <p class="param-tip">çŸ­äºæ­¤æ—¶é•¿çš„é™éŸ³ç‰‡æ®µå°†è¢«å¿½ç•¥</p>
                        </div>

                        <div class="param-group">
                            <label for="minVoiceDuration">æœ€å°äººå£°æ—¶é•¿ (ç§’)</label>
                            <div class="param-control">
                                <input type="range" id="minVoiceDuration" min="0.1" max="2" value="0.5" step="0.1">
                                <input type="number" id="minVoiceDurationValue" min="0.1" max="2" value="0.5" step="0.1">
                                <span class="param-unit">ç§’</span>
                            </div>
                            <p class="param-tip">çŸ­äºæ­¤æ—¶é•¿çš„äººå£°ç‰‡æ®µå°†è¢«å¿½ç•¥</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- éŸ³é¢‘æ³¢å½¢æ˜¾ç¤ºåŒºåŸŸ -->
            <section class="waveform-section" id="waveformSection" style="display: none;">
                <h3>éŸ³é¢‘æ³¢å½¢åˆ†æ</h3>
                <div class="waveform-container">
                    <div class="waveform-controls">
                        <button class="control-btn" id="samplingBtn">ğŸ¯ é‡‡æ ·å·¥å…·</button>
                        <button class="control-btn" id="playBtn">â–¶ï¸ æ’­æ”¾</button>
                        <button class="control-btn" id="pauseBtn" style="display: none;">â¸ï¸ æš‚åœ</button>
                        <span class="time-display" id="timeDisplay">00:00 / 00:00</span>
                    </div>

                    <!-- æ³¢å½¢å›¾åŒºåŸŸ -->
                    <div class="waveform-canvas-container">
                        <canvas id="waveformCanvas" width="800" height="200"></canvas>
                        <div class="threshold-line" id="thresholdLine"></div>
                        <div class="playhead" id="playhead"></div>
                    </div>

                    <!-- æ³¢å½¢å›¾å·¥å…·æ  -->
                    <div class="waveform-toolbar">
                        <button class="tool-btn" id="cutTool">âœ‚ï¸ åˆ‡å‰²</button>
                        <button class="tool-btn" id="mergeTool">ğŸ”— åˆå¹¶</button>
                        <button class="tool-btn" id="deleteTool">ğŸ—‘ï¸ åˆ é™¤</button>
                        <button class="tool-btn" id="undoBtn">â†¶ æ’¤é”€</button>
                        <button class="tool-btn" id="redoBtn">â†· é‡åš</button>
                    </div>

                    <!-- ç‰‡æ®µä¿¡æ¯ -->
                    <div class="segments-info">
                        <div class="segment-stats">
                            <span class="stat">æœ‰ç”¨ç‰‡æ®µ: <strong id="validSegments">0</strong></span>
                            <span class="stat">é™éŸ³ç‰‡æ®µ: <strong id="silentSegments">0</strong></span>
                            <span class="stat">æ€»æ—¶é•¿: <strong id="totalDuration">00:00</strong></span>
                            <span class="stat">ä¿ç•™æ—¶é•¿: <strong id="keepDuration">00:00</strong></span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- é¢„è§ˆå’Œè¾“å‡ºåŒºåŸŸ -->
            <section class="output-section" id="outputSection" style="display: none;">
                <h3>é¢„è§ˆä¸è¾“å‡º</h3>

                <!-- é¢„è§ˆåŠŸèƒ½ -->
                <div class="preview-area">
                    <h4>æ•ˆæœé¢„è§ˆ</h4>
                    <p>æ’­æ”¾30ç§’å…¸å‹ç‰‡æ®µï¼Œç¡®è®¤å¤„ç†æ•ˆæœ</p>
                    <button class="preview-btn" id="previewBtn">ğŸµ ç”Ÿæˆé¢„è§ˆ</button>
                    <audio id="previewAudio" controls style="display: none;"></audio>
                </div>

                <!-- è¾“å‡ºè®¾ç½® -->
                <div class="output-settings">
                    <h4>è¾“å‡ºè®¾ç½®</h4>

                    <div class="setting-group">
                        <label>è¾“å‡ºæ ¼å¼</label>
                        <select id="outputFormat">
                            <option value="mp4">è§†é¢‘ (MP4)</option>
                            <option value="mp3">éŸ³é¢‘ (MP3)</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <label>è¾“å‡ºè´¨é‡</label>
                        <select id="outputQuality">
                            <option value="high">é«˜è´¨é‡</option>
                            <option value="medium" selected>ä¸­ç­‰è´¨é‡</option>
                            <option value="low">å¿«é€Ÿå‹ç¼©</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <label>è¾“å‡ºæ–¹å¼</label>
                        <select id="outputMethod">
                            <option value="download">ç›´æ¥ä¸‹è½½æ–‡ä»¶</option>
                            <option value="premiere">ç”Ÿæˆ Premiere Pro XML</option>
                            <option value="finalcut">ç”Ÿæˆ Final Cut Pro XML</option>
                        </select>
                    </div>
                </div>

                <!-- å¤„ç†æŒ‰é’® -->
                <div class="process-area">
                    <button class="process-btn" id="processBtn">ğŸš€ å¼€å§‹å¤„ç†</button>
                    <div class="process-status" id="processStatus" style="display: none;">
                        <div class="process-progress">
                            <div class="process-bar" id="processBar"></div>
                        </div>
                        <p class="process-text" id="processText">æ­£åœ¨å¤„ç†ä¸­...</p>
                        <p class="process-eta" id="processEta">é¢„è®¡å®Œæˆæ—¶é—´: 2åˆ†é’Ÿ</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- é¡µè„š -->
        <footer class="footer">
            <p>&copy; 2024 è‡ªåª’ä½“å·¥å…·é›† - ä¸“ä¸ºåˆ›ä½œè€…æ‰“é€ çš„æ•ˆç‡å·¥å…·</p>
        </footer>
    </div>

    <script>
        // å…¨å±€å˜é‡
let uploadedFile = null;
let audioContext = null;
let audioBuffer = null;
let waveformData = null;
let silenceSegments = [];
let voiceSegments = [];

// DOM å…ƒç´ 
const uploadArea = document.getElementById('uploadArea');
const fileInput = document.getElementById('fileInput');
const fileInfo = document.getElementById('fileInfo');
const configSection = document.getElementById('configSection');
const waveformSection = document.getElementById('waveformSection');
const outputSection = document.getElementById('outputSection');

// é¢„è®¾å‚æ•°
const presets = {
    slow: { threshold: -50, leading: 0.5, trailing: 0.8, desc: 'é€‚ç”¨äºè®¿è°ˆã€æ’­å®¢ç­‰åœé¡¿è¾ƒå¤šçš„åœºæ™¯' },
    medium: { threshold: -40, leading: 0.3, trailing: 0.5, desc: 'é€‚ç”¨äºå¤§å¤šæ•°æ ‡å‡†å£æ’­è§†é¢‘' },
    fast: { threshold: -35, leading: 0.2, trailing: 0.3, desc: 'é€‚ç”¨äºä¿¡æ¯å¯†é›†ã€è¯­é€Ÿå¿«çš„çŸ­è§†é¢‘' },
    custom: { threshold: -40, leading: 0.3, trailing: 0.5, desc: 'è‡ªå®šä¹‰å‚æ•°è®¾ç½®' }
};

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    initializeEventListeners();
    initializePresets();
    initializeParameterSync();
    initializeAdvancedToggle();
});

// åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
function initializeEventListeners() {
    // æ–‡ä»¶ä¸Šä¼ ç›¸å…³
    uploadArea.addEventListener('click', () => fileInput.click());
    uploadArea.addEventListener('dragover', handleDragOver);
    uploadArea.addEventListener('dragleave', handleDragLeave);
    uploadArea.addEventListener('drop', handleFileDrop);
    fileInput.addEventListener('change', handleFileSelect);

    // æ³¢å½¢ç›¸å…³
    const samplingBtn = document.getElementById('samplingBtn');
    const playBtn = document.getElementById('playBtn');
    const pauseBtn = document.getElementById('pauseBtn');

    samplingBtn?.addEventListener('click', toggleSamplingMode);
    playBtn?.addEventListener('click', playAudio);
    pauseBtn?.addEventListener('click', pauseAudio);

    // å¤„ç†ç›¸å…³
    const previewBtn = document.getElementById('previewBtn');
    const processBtn = document.getElementById('processBtn');

    previewBtn?.addEventListener('click', generatePreview);
    processBtn?.addEventListener('click', startProcessing);
}

// åˆå§‹åŒ–é¢„è®¾
function initializePresets() {
    const modeButtons = document.querySelectorAll('.mode-btn');
    const modeDesc = document.getElementById('modeDesc');

    modeButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            // ç§»é™¤æ‰€æœ‰activeç±»
            modeButtons.forEach(b => b.classList.remove('active'));
            // æ·»åŠ activeç±»åˆ°å½“å‰æŒ‰é’®
            btn.classList.add('active');

            const mode = btn.dataset.mode;
            const preset = presets[mode];

            if (preset) {
                // æ›´æ–°æè¿°
                modeDesc.textContent = preset.desc;

                // æ›´æ–°å‚æ•°ï¼ˆé™¤éæ˜¯è‡ªå®šä¹‰æ¨¡å¼ï¼‰
                if (mode !== 'custom') {
                    updateParameters(preset);
                }
            }
        });
    });
}

// æ›´æ–°å‚æ•°
function updateParameters(preset) {
    const silenceThreshold = document.getElementById('silenceThreshold');
    const silenceThresholdValue = document.getElementById('silenceThresholdValue');
    const leadingPadding = document.getElementById('leadingPadding');
    const leadingPaddingValue = document.getElementById('leadingPaddingValue');
    const trailingPadding = document.getElementById('trailingPadding');
    const trailingPaddingValue = document.getElementById('trailingPaddingValue');

    if (silenceThreshold && silenceThresholdValue) {
        silenceThreshold.value = preset.threshold;
        silenceThresholdValue.value = preset.threshold;
    }
    if (leadingPadding && leadingPaddingValue) {
        leadingPadding.value = preset.leading;
        leadingPaddingValue.value = preset.leading;
    }
    if (trailingPadding && trailingPaddingValue) {
        trailingPadding.value = preset.trailing;
        trailingPaddingValue.value = preset.trailing;
    }

    // æ›´æ–°é˜ˆå€¼çº¿ä½ç½®
    updateThresholdLine();
}

// åˆå§‹åŒ–å‚æ•°åŒæ­¥
function initializeParameterSync() {
    const params = [
        'silenceThreshold',
        'leadingPadding',
        'trailingPadding',
        'minSilenceDuration',
        'minVoiceDuration'
    ];

    params.forEach(param => {
        const slider = document.getElementById(param);
        const input = document.getElementById(param + 'Value');

        if (slider && input) {
            slider.addEventListener('input', (e) => {
                input.value = e.target.value;
                if (param === 'silenceThreshold') {
                    updateThresholdLine();
                }
                // åˆ‡æ¢åˆ°è‡ªå®šä¹‰æ¨¡å¼
                switchToCustomMode();
            });

            input.addEventListener('input', (e) => {
                slider.value = e.target.value;
                if (param === 'silenceThreshold') {
                    updateThresholdLine();
                }
                // åˆ‡æ¢åˆ°è‡ªå®šä¹‰æ¨¡å¼
                switchToCustomMode();
            });
        }
    });
}

// åˆ‡æ¢åˆ°è‡ªå®šä¹‰æ¨¡å¼
function switchToCustomMode() {
    const customBtn = document.querySelector('.mode-btn[data-mode="custom"]');
    const modeButtons = document.querySelectorAll('.mode-btn');
    const modeDesc = document.getElementById('modeDesc');

    if (customBtn) {
        modeButtons.forEach(btn => btn.classList.remove('active'));
        customBtn.classList.add('active');
        modeDesc.textContent = presets.custom.desc;
    }
}

// åˆå§‹åŒ–é«˜çº§å‚æ•°åˆ‡æ¢
function initializeAdvancedToggle() {
    const toggleBtn = document.getElementById('toggleAdvanced');
    const advancedContent = document.querySelector('.advanced-content');

    if (toggleBtn && advancedContent) {
        toggleBtn.addEventListener('click', () => {
            const isVisible = advancedContent.style.display !== 'none';
            advancedContent.style.display = isVisible ? 'none' : 'grid';
            toggleBtn.textContent = isVisible ? 'å±•å¼€' : 'æ”¶èµ·';
        });
    }
}

// æ‹–æ‹½å¤„ç†
function handleDragOver(e) {
    e.preventDefault();
    uploadArea.classList.add('dragover');
}

function handleDragLeave(e) {
    e.preventDefault();
    uploadArea.classList.remove('dragover');
}

function handleFileDrop(e) {
    e.preventDefault();
    uploadArea.classList.remove('dragover');

    const files = e.dataTransfer.files;
    if (files.length > 0) {
        handleFile(files[0]);
    }
}

// æ–‡ä»¶é€‰æ‹©å¤„ç†
function handleFileSelect(e) {
    const file = e.target.files[0];
    if (file) {
        handleFile(file);
    }
}

// å¤„ç†æ–‡ä»¶
function handleFile(file) {
    // éªŒè¯æ–‡ä»¶ç±»å‹
    const validTypes = ['audio/mpeg', 'audio/wav', 'audio/mp4', 'video/mp4', 'video/quicktime'];
    const validExtensions = ['.mp3', '.wav', '.m4a', '.mp4', '.mov'];

    const isValidType = validTypes.some(type => file.type.includes(type));
    const isValidExtension = validExtensions.some(ext => file.name.toLowerCase().endsWith(ext));

    if (!isValidType && !isValidExtension) {
        showError('ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œè¯·é€‰æ‹© MP4, MOV, MP3, WAV, M4A æ ¼å¼çš„æ–‡ä»¶');
        return;
    }

    uploadedFile = file;
    showFileInfo(file);
    simulateUpload();
}

// æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
function showFileInfo(file) {
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const fileDuration = document.getElementById('fileDuration');

    if (fileName) fileName.textContent = file.name;
    if (fileSize) fileSize.textContent = formatFileSize(file.size);
    if (fileDuration) fileDuration.textContent = 'æ­£åœ¨åˆ†æ...';

    fileInfo.style.display = 'block';
}

// æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// æ¨¡æ‹Ÿä¸Šä¼ è¿›åº¦
function simulateUpload() {
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');

    let progress = 0;
    const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress >= 100) {
            progress = 100;
            clearInterval(interval);
            setTimeout(() => {
                onUploadComplete();
            }, 500);
        }

        if (progressBar) progressBar.style.width = progress + '%';
        if (progressText) progressText.textContent = Math.round(progress) + '%';
    }, 200);
}

// ä¸Šä¼ å®Œæˆ
function onUploadComplete() {
    const fileDuration = document.getElementById('fileDuration');
    if (fileDuration) {
        // æ¨¡æ‹ŸéŸ³é¢‘æ—¶é•¿
        const duration = Math.floor(Math.random() * 3600 + 300); // 5-65åˆ†é’Ÿ
        fileDuration.textContent = formatDuration(duration);
    }

    // æ˜¾ç¤ºé…ç½®åŒºåŸŸ
    configSection.style.display = 'block';

    // æ¨¡æ‹ŸéŸ³é¢‘åˆ†æ
    setTimeout(() => {
        analyzeAudio();
    }, 1000);
}

// æ ¼å¼åŒ–æ—¶é•¿
function formatDuration(seconds) {
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;

    if (hours > 0) {
        return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    } else {
        return `${minutes}:${secs.toString().padStart(2, '0')}`;
    }
}

// åˆ†æéŸ³é¢‘
function analyzeAudio() {
    // æ¨¡æ‹ŸéŸ³é¢‘åˆ†æè¿‡ç¨‹
    showSuccess('éŸ³é¢‘åˆ†æå®Œæˆï¼Œæ­£åœ¨ç”Ÿæˆæ³¢å½¢å›¾...');

    setTimeout(() => {
        generateWaveform();
        waveformSection.style.display = 'block';
        outputSection.style.display = 'block';
    }, 1500);
}

// ç”Ÿæˆæ³¢å½¢å›¾
function generateWaveform() {
    const canvas = document.getElementById('waveformCanvas');
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    const width = canvas.width = canvas.offsetWidth;
    const height = canvas.height = 200;

    // ç”Ÿæˆæ¨¡æ‹Ÿæ³¢å½¢æ•°æ®
    generateMockWaveformData(width);

    // ç»˜åˆ¶æ³¢å½¢
    drawWaveform(ctx, width, height);

    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    updateSegmentStats();

    // åˆå§‹åŒ–é˜ˆå€¼çº¿
    updateThresholdLine();
}

// ç”Ÿæˆæ¨¡æ‹Ÿæ³¢å½¢æ•°æ®
function generateMockWaveformData(width) {
    waveformData = [];
    silenceSegments = [];
    voiceSegments = [];

    const threshold = parseFloat(document.getElementById('silenceThreshold')?.value || -40);

    for (let i = 0; i < width; i++) {
        // ç”Ÿæˆå¸¦æœ‰é™éŸ³ç‰‡æ®µçš„æ¨¡æ‹ŸéŸ³é¢‘æ•°æ®
        let amplitude;
        if (Math.random() < 0.3) { // 30%æ¦‚ç‡ä¸ºé™éŸ³
            amplitude = Math.random() * 0.1 - 0.8; // -0.8 åˆ° -0.7 (é™éŸ³)
        } else {
            amplitude = Math.random() * 0.6 - 0.3; // -0.3 åˆ° 0.3 (æœ‰å£°)
        }

        waveformData.push(amplitude);
    }

    // åˆ†æç‰‡æ®µ
    analyzeSegments(threshold);
}

// åˆ†æç‰‡æ®µ
function analyzeSegments(threshold) {
    if (!waveformData) return;

    silenceSegments = [];
    voiceSegments = [];

    let currentSegmentStart = 0;
    let currentSegmentType = null; // 'silence' or 'voice'

    const thresholdNormalized = (threshold + 60) / 60; // è½¬æ¢åˆ°0-1èŒƒå›´

    for (let i = 0; i < waveformData.length; i++) {
        const amplitude = Math.abs(waveformData[i]);
        const isVoice = amplitude > Math.abs(thresholdNormalized);
        const segmentType = isVoice ? 'voice' : 'silence';

        if (currentSegmentType === null) {
            currentSegmentType = segmentType;
            currentSegmentStart = i;
        } else if (currentSegmentType !== segmentType) {
            // ä¿å­˜å½“å‰ç‰‡æ®µ
            const segment = {
                start: currentSegmentStart,
                end: i - 1,
                type: currentSegmentType
            };

            if (currentSegmentType === 'silence') {
                silenceSegments.push(segment);
            } else {
                voiceSegments.push(segment);
            }

            // å¼€å§‹æ–°ç‰‡æ®µ
            currentSegmentType = segmentType;
            currentSegmentStart = i;
        }
    }

    // ä¿å­˜æœ€åä¸€ä¸ªç‰‡æ®µ
    if (currentSegmentType) {
        const segment = {
            start: currentSegmentStart,
            end: waveformData.length - 1,
            type: currentSegmentType
        };

        if (currentSegmentType === 'silence') {
            silenceSegments.push(segment);
        } else {
            voiceSegments.push(segment);
        }
    }
}

// ç»˜åˆ¶æ³¢å½¢
function drawWaveform(ctx, width, height) {
    if (!waveformData) return;

    ctx.clearRect(0, 0, width, height);

    const centerY = height / 2;
    const maxAmplitude = Math.max(...waveformData.map(Math.abs));

    // ç»˜åˆ¶èƒŒæ™¯
    ctx.fillStyle = '#f8fafc';
    ctx.fillRect(0, 0, width, height);

    // ç»˜åˆ¶ä¸­å¿ƒçº¿
    ctx.strokeStyle = '#e2e8f0';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(0, centerY);
    ctx.lineTo(width, centerY);
    ctx.stroke();

    // ç»˜åˆ¶æ³¢å½¢
    for (let i = 0; i < waveformData.length; i++) {
        const amplitude = waveformData[i];
        const normalizedAmplitude = (amplitude / maxAmplitude) * (centerY - 10);

        // æ ¹æ®ç‰‡æ®µç±»å‹é€‰æ‹©é¢œè‰²
        const isInSilenceSegment = silenceSegments.some(seg => i >= seg.start && i <= seg.end);
        ctx.fillStyle = isInSilenceSegment ? '#9ca3af' : '#3b82f6';

        const barHeight = Math.abs(normalizedAmplitude);
        const x = i;
        const y = centerY - barHeight / 2;

        ctx.fillRect(x, y, 1, barHeight);
    }
}

// æ›´æ–°é˜ˆå€¼çº¿
function updateThresholdLine() {
    const thresholdLine = document.getElementById('thresholdLine');
    const canvas = document.getElementById('waveformCanvas');
    const threshold = parseFloat(document.getElementById('silenceThreshold')?.value || -40);

    if (thresholdLine && canvas) {
        // å°†dBå€¼è½¬æ¢ä¸ºç”»å¸ƒä½ç½®
        const normalizedThreshold = (threshold + 60) / 60; // -60dB åˆ° 0dB æ˜ å°„åˆ° 0-1
        const position = canvas.offsetHeight * (1 - normalizedThreshold);

        thresholdLine.style.top = position + 'px';

        // é‡æ–°åˆ†æç‰‡æ®µ
        if (waveformData) {
            analyzeSegments(threshold);
            const ctx = canvas.getContext('2d');
            drawWaveform(ctx, canvas.offsetWidth, canvas.offsetHeight);
            updateSegmentStats();
        }
    }
}

// æ›´æ–°ç‰‡æ®µç»Ÿè®¡
function updateSegmentStats() {
    const validSegmentsEl = document.getElementById('validSegments');
    const silentSegmentsEl = document.getElementById('silentSegments');
    const totalDurationEl = document.getElementById('totalDuration');
    const keepDurationEl = document.getElementById('keepDuration');

    if (validSegmentsEl) validSegmentsEl.textContent = voiceSegments.length;
    if (silentSegmentsEl) silentSegmentsEl.textContent = silenceSegments.length;
    if (totalDurationEl) totalDurationEl.textContent = '45:32'; // æ¨¡æ‹Ÿæ€»æ—¶é•¿
    if (keepDurationEl) keepDurationEl.textContent = '38:45'; // æ¨¡æ‹Ÿä¿ç•™æ—¶é•¿
}

// é‡‡æ ·æ¨¡å¼
let samplingMode = false;

function toggleSamplingMode() {
    const samplingBtn = document.getElementById('samplingBtn');
    samplingMode = !samplingMode;

    if (samplingMode) {
        samplingBtn.classList.add('active');
        samplingBtn.textContent = 'ğŸ¯ ç‚¹å‡»æ³¢å½¢é‡‡æ ·';
        // æ·»åŠ ç”»å¸ƒç‚¹å‡»äº‹ä»¶
        const canvas = document.getElementById('waveformCanvas');
        if (canvas) {
            canvas.style.cursor = 'crosshair';
            canvas.addEventListener('click', handleWaveformSampling);
        }
    } else {
        samplingBtn.classList.remove('active');
        samplingBtn.textContent = 'ğŸ¯ é‡‡æ ·å·¥å…·';
        // ç§»é™¤ç”»å¸ƒç‚¹å‡»äº‹ä»¶
        const canvas = document.getElementById('waveformCanvas');
        if (canvas) {
            canvas.style.cursor = 'default';
            canvas.removeEventListener('click', handleWaveformSampling);
        }
    }
}

// å¤„ç†æ³¢å½¢é‡‡æ ·
function handleWaveformSampling(e) {
    if (!samplingMode || !waveformData) return;

    const canvas = e.target;
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    // å°†ç”»å¸ƒåæ ‡è½¬æ¢ä¸ºæ•°æ®ç´¢å¼•
    const dataIndex = Math.floor((x / canvas.offsetWidth) * waveformData.length);

    if (dataIndex >= 0 && dataIndex < waveformData.length) {
        const amplitude = Math.abs(waveformData[dataIndex]);
        // å°†å¹…åº¦è½¬æ¢ä¸ºdBå€¼ï¼ˆæ¨¡æ‹Ÿï¼‰
        const dbValue = Math.round((amplitude * 60) - 60);

        // æ›´æ–°é˜ˆå€¼å‚æ•°
        const silenceThreshold = document.getElementById('silenceThreshold');
        const silenceThresholdValue = document.getElementById('silenceThresholdValue');

        if (silenceThreshold && silenceThresholdValue) {
            silenceThreshold.value = dbValue;
            silenceThresholdValue.value = dbValue;
        }

        // åˆ‡æ¢åˆ°è‡ªå®šä¹‰æ¨¡å¼
        switchToCustomMode();

        // æ›´æ–°é˜ˆå€¼çº¿
        updateThresholdLine();

        // é€€å‡ºé‡‡æ ·æ¨¡å¼
        toggleSamplingMode();

        showSuccess(`å·²è®¾ç½®é™éŸ³é˜ˆå€¼ä¸º ${dbValue} dB`);
    }
}

// æ’­æ”¾æ§åˆ¶
function playAudio() {
    const playBtn = document.getElementById('playBtn');
    const pauseBtn = document.getElementById('pauseBtn');

    if (playBtn) playBtn.style.display = 'none';
    if (pauseBtn) pauseBtn.style.display = 'inline-block';

    // æ¨¡æ‹Ÿæ’­æ”¾
    showSuccess('å¼€å§‹æ’­æ”¾éŸ³é¢‘');
}

function pauseAudio() {
    const playBtn = document.getElementById('playBtn');
    const pauseBtn = document.getElementById('pauseBtn');

    if (playBtn) playBtn.style.display = 'inline-block';
    if (pauseBtn) pauseBtn.style.display = 'none';

    showSuccess('æš‚åœæ’­æ”¾');
}

// ç”Ÿæˆé¢„è§ˆ
function generatePreview() {
    const previewAudio = document.getElementById('previewAudio');
    const previewBtn = document.getElementById('previewBtn');

    if (previewBtn) previewBtn.textContent = 'ğŸ”„ æ­£åœ¨ç”Ÿæˆé¢„è§ˆ...';

    setTimeout(() => {
        if (previewBtn) previewBtn.textContent = 'ğŸµ ç”Ÿæˆé¢„è§ˆ';
        if (previewAudio) {
            previewAudio.style.display = 'block';
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šè®¾ç½®å¤„ç†åçš„éŸ³é¢‘é¢„è§ˆ
            showSuccess('é¢„è§ˆç”Ÿæˆå®Œæˆï¼Œè¯·æ’­æ”¾æŸ¥çœ‹æ•ˆæœ');
        }
    }, 2000);
}

// å¼€å§‹å¤„ç†
function startProcessing() {
    const processBtn = document.getElementById('processBtn');
    const processStatus = document.getElementById('processStatus');
    const processBar = document.getElementById('processBar');
    const processText = document.getElementById('processText');

    if (processBtn) {
        processBtn.textContent = 'ğŸ”„ å¤„ç†ä¸­...';
        processBtn.disabled = true;
    }

    if (processStatus) processStatus.style.display = 'block';

    // æ¨¡æ‹Ÿå¤„ç†è¿›åº¦
    let progress = 0;
    const interval = setInterval(() => {
        progress += Math.random() * 5;
        if (progress >= 100) {
            progress = 100;
            clearInterval(interval);
            setTimeout(() => {
                onProcessingComplete();
            }, 500);
        }

        if (processBar) processBar.style.width = progress + '%';
        if (processText) {
            if (progress < 30) {
                processText.textContent = 'æ­£åœ¨åˆ†æéŸ³é¢‘...';
            } else if (progress < 70) {
                processText.textContent = 'æ­£åœ¨å¤„ç†é™éŸ³ç‰‡æ®µ...';
            } else if (progress < 95) {
                processText.textContent = 'æ­£åœ¨ç”Ÿæˆè¾“å‡ºæ–‡ä»¶...';
            } else {
                processText.textContent = 'å¤„ç†å®Œæˆï¼';
            }
        }
    }, 300);
}

// å¤„ç†å®Œæˆ
function onProcessingComplete() {
    const processBtn = document.getElementById('processBtn');
    const processText = document.getElementById('processText');

    if (processBtn) {
        processBtn.textContent = 'ğŸ“¥ ä¸‹è½½å¤„ç†åçš„æ–‡ä»¶';
        processBtn.disabled = false;
        processBtn.onclick = downloadFile;
    }

    if (processText) {
        processText.textContent = 'å¤„ç†å®Œæˆï¼ç‚¹å‡»ä¸‹è½½æ–‡ä»¶';
    }

    showSuccess('æ–‡ä»¶å¤„ç†å®Œæˆï¼');
}

// ä¸‹è½½æ–‡ä»¶
function downloadFile() {
    const outputFormat = document.getElementById('outputFormat')?.value || 'mp4';
    const outputMethod = document.getElementById('outputMethod')?.value || 'download';

    let fileName = 'processed_audio';
    let fileType = 'video/mp4';

    switch (outputMethod) {
        case 'premiere':
            fileName += '_premiere.xml';
            fileType = 'application/xml';
            break;
        case 'finalcut':
            fileName += '_finalcut.fcpxml';
            fileType = 'application/xml';
            break;
        default:
            fileName += outputFormat === 'mp3' ? '.mp3' : '.mp4';
            fileType = outputFormat === 'mp3' ? 'audio/mpeg' : 'video/mp4';
    }

    // æ¨¡æ‹Ÿæ–‡ä»¶ä¸‹è½½
    const blob = new Blob(['æ¨¡æ‹Ÿæ–‡ä»¶å†…å®¹'], { type: fileType });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = fileName;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    showSuccess(`å·²ä¸‹è½½ ${fileName}`);
}

// æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
function showError(message) {
    const errorDiv = document.createElement('div');
    errorDiv.className = 'error-message';
    errorDiv.textContent = message;
    errorDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #fef2f2;
        color: #dc2626;
        padding: 16px 24px;
        border-radius: 8px;
        border: 1px solid #fecaca;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        max-width: 400px;
    `;

    document.body.appendChild(errorDiv);

    setTimeout(() => {
        if (errorDiv.parentNode) {
            errorDiv.parentNode.removeChild(errorDiv);
        }
    }, 5000);
}

// æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
function showSuccess(message) {
    const successDiv = document.createElement('div');
    successDiv.className = 'success-message';
    successDiv.textContent = message;
    successDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #f0fdf4;
        color: #059669;
        padding: 16px 24px;
        border-radius: 8px;
        border: 1px solid #dcfce7;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        max-width: 400px;
    `;

    document.body.appendChild(successDiv);

    setTimeout(() => {
        if (successDiv.parentNode) {
            successDiv.parentNode.removeChild(successDiv);
        }
    }, 3000);
}

// çª—å£å¤§å°è°ƒæ•´å¤„ç†
window.addEventListener('resize', () => {
    setTimeout(() => {
        const canvas = document.getElementById('waveformCanvas');
        if (canvas && waveformData) {
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = 200;
            drawWaveform(ctx, width, height);
            updateThresholdLine();
        }
    }, 100);
});
    </script>
</body>
</html>