<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自媒体工具集 - 静音片段过滤工具</title>
    <style>
        /* CSS变量定义 */
:root {
    --color--foreground-fg--fg-base-88: #000000e0;
    --color--foreground-fg--fg-link: #1a4be1;
    --color--foreground-fg--fg-link-hover: #1a40ca;
    --color--foreground-fg--fg-base-65: #000000a6;
    --color--background-bg--bg-gray-gray: #f3f4f6;
    --color--border--neutralbold: #8995a7;
    --color--foreground-fg--fg-base: black;
    --color--background-bg--bg-black: #01091b;
    --color--accent--accent-solid: #cf163e;
    --color--accent--accent-solid-hover: #9c102e;
    --color--foreground-fg--fg-oncontrast: #fff;
    --color--border--accentminimal: #ffe3e5;
    --color--border--accentbold: #ffa1ac;
    --color--border--gray-secondary: #e5e7eb;
    --color--foreground-fg--fg-accent: #cf163e;
    --color--background-bg--bg-gray: #f8f8f8;
    --color--border--neutralsuble: #d6dae1;
    --color--background-bg--bg-white: white;
    --color--background-bg--bg-subtle: #fff1f2;
    --color--border--accentsubtle: #ffcbd2;
    --color--border--neutralminimal: #fcfcfc;
    --color--foreground-fg--fg-disabled: #b5b5b5;
    --color--foreground-fg--fg-placeholder: #b5b5b5;
    --radius--8px: 8px;
    --radius--4px: 4px;
    --radius--12px: 12px;
    --radius--16px: 16px;
    --empty-space--64px: 64px;
    --empty-space--48px: 48px;
    --empty-space--32px: 32px;
    --empty-space--24px: 24px;
    --empty-space--16px: 16px;
}

/* 重置样式 */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: Geist, Arial, sans-serif;
    line-height: 1.6;
    color: var(--color--foreground-fg--fg-base-88);
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
    min-height: 100vh;
    font-size: 16px;
    font-weight: 400;
}

.container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0 40px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

/* 标题样式 */
h1 {
    font-family: Satoshi, Arial, sans-serif;
    font-size: 72px;
    margin-top: 20px;
    margin-bottom: 10px;
    font-weight: 700;
    line-height: 1.1em;
}

h2 {
    font-family: Satoshi, Arial, sans-serif;
    font-size: 56px;
    margin-top: 20px;
    margin-bottom: 10px;
    font-weight: 700;
    line-height: 1.17em;
}

h3 {
    font-family: Satoshi, Arial, sans-serif;
    font-size: 36px;
    margin-top: 20px;
    margin-bottom: 10px;
    font-weight: 700;
    line-height: 1.27em;
}

h4 {
    font-family: Satoshi, Arial, sans-serif;
    font-size: 28px;
    margin-top: 10px;
    margin-bottom: 10px;
    font-weight: 700;
    line-height: 1.28em;
}

h5 {
    font-family: Satoshi, Arial, sans-serif;
    font-size: 22px;
    margin-top: 10px;
    margin-bottom: 10px;
    font-weight: 700;
    line-height: 1.27em;
}

h6 {
    font-family: Satoshi, Arial, sans-serif;
    font-size: 18px;
    margin-top: 10px;
    margin-bottom: 10px;
    font-weight: 700;
    line-height: 1.33em;
}

p {
    font-size: 16px;
    margin-bottom: 10px;
    line-height: 1.6em;
}

a {
    color: var(--color--foreground-fg--fg-link);
    text-decoration: none;
}

a:hover {
    color: var(--color--foreground-fg--fg-link-hover);
}

/* 头部样式 */
.header {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: var(--radius--16px);
    padding: 24px 32px;
    margin-bottom: 32px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo h1 {
    font-size: 2em;
    font-weight: 700;
    color: var(--color--accent--accent-solid);
    margin-bottom: 4px;
}

.logo p {
    color: var(--color--foreground-fg--fg-base-65);
    font-size: 0.9em;
}

.nav {
    display: flex;
    gap: 16px;
}

.nav-item {
    padding: 12px 24px;
    border-radius: var(--radius--8px);
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
    font-family: Satoshi, Arial, sans-serif;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    font-size: 12px;
}

.nav-item.active {
    background: var(--color--accent--accent-solid);
    color: white;
}

.nav-item.disabled {
    color: var(--color--foreground-fg--fg-disabled);
    cursor: not-allowed;
}

/* 主内容区域 */
.main {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 32px;
}

/* 工具标题区 */
.tool-header {
    text-align: center;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: var(--radius--16px);
    padding: 48px 32px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.tool-header h2 {
    font-size: 56px;
    font-weight: 700;
    color: var(--color--foreground-fg--fg-base);
    margin-bottom: 12px;
}

.tool-header p {
    font-size: 18px;
    color: var(--color--foreground-fg--fg-base-65);
    line-height: 1.55em;
}

/* 卡片通用样式 */
.section {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: var(--radius--16px);
    padding: 32px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    margin-bottom: 24px;
}

/* 文件上传区域 */
.upload-section {
    position: relative;
}

.upload-area {
    border: 3px dashed var(--color--border--neutralbold);
    border-radius: var(--radius--12px);
    padding: 48px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: var(--color--background-bg--bg-gray);
    position: relative;
    overflow: hidden;
}

.upload-area::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    transition: left 0.5s;
}

.upload-area:hover::before {
    left: 100%;
}

.upload-area:hover {
    border-color: var(--color--accent--accent-solid);
    background: var(--color--border--accentminimal);
    transform: translateY(-2px);
    box-shadow: 0 12px 40px rgba(207, 22, 62, 0.15);
}

.upload-area.dragover {
    border-color: var(--color--accent--accent-solid);
    background: var(--color--border--accentminimal);
    transform: scale(1.02);
    box-shadow: 0 16px 48px rgba(207, 22, 62, 0.2);
}

.upload-icon {
    font-size: 4em;
    margin-bottom: 16px;
    filter: grayscale(1);
    transition: filter 0.3s ease;
}

.upload-area:hover .upload-icon {
    filter: grayscale(0);
}

.upload-area h3 {
    font-size: 24px;
    margin-bottom: 8px;
    color: var(--color--foreground-fg--fg-base);
    font-weight: 700;
}

.upload-area p {
    color: var(--color--foreground-fg--fg-base-65);
    margin-bottom: 24px;
    font-size: 16px;
}

.upload-btn {
    background: var(--color--accent--accent-solid);
    color: white;
    border: none;
    padding: 16px 32px;
    border-radius: var(--radius--8px);
    font-size: 1em;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    font-family: Satoshi, Arial, sans-serif;
    font-size: 12px;
}

.upload-btn:hover {
    background: var(--color--accent--accent-solid-hover);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(207, 22, 62, 0.3);
}

/* 文件信息显示 */
.file-info {
    margin-top: 24px;
    padding: 24px;
    background: var(--color--border--accentminimal);
    border-radius: var(--radius--12px);
    border: 1px solid var(--color--border--accentsubtle);
}

.file-details {
    display: flex;
    gap: 24px;
    margin-bottom: 16px;
    flex-wrap: wrap;
}

.file-name {
    font-weight: 600;
    color: var(--color--accent--accent-solid);
}

.file-size,
.file-duration {
    color: var(--color--foreground-fg--fg-base-65);
}

.upload-progress {
    display: flex;
    align-items: center;
    gap: 16px;
}

.progress-bar {
    flex: 1;
    height: 8px;
    background: var(--color--border--accentsubtle);
    border-radius: 4px;
    overflow: hidden;
    position: relative;
}

.progress-bar::after {
    content: '';
    display: block;
    height: 100%;
    background: var(--color--accent--accent-solid);
    width: 0%;
    transition: width 0.3s ease;
}

.progress-text {
    font-weight: 600;
    color: var(--color--accent--accent-solid);
    min-width: 40px;
}

/* 参数配置区域 */
.config-section h3 {
    font-size: 28px;
    margin-bottom: 24px;
    color: var(--color--foreground-fg--fg-base);
}

/* 预设档位 */
.preset-modes {
    margin-bottom: 32px;
}

.preset-modes h4 {
    font-size: 20px;
    margin-bottom: 16px;
    color: var(--color--foreground-fg--fg-base);
}

.mode-buttons {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 12px;
    margin-bottom: 12px;
}

.mode-btn {
    padding: 16px 24px;
    border: 2px solid var(--color--border--gray-secondary);
    background: white;
    border-radius: var(--radius--8px);
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
    text-align: center;
    font-family: Satoshi, Arial, sans-serif;
}

.mode-btn:hover {
    border-color: var(--color--accent--accent-solid);
    background: var(--color--border--accentminimal);
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(207, 22, 62, 0.1);
}

.mode-btn.active {
    border-color: var(--color--accent--accent-solid);
    background: var(--color--accent--accent-solid);
    color: white;
    box-shadow: 0 8px 24px rgba(207, 22, 62, 0.3);
}

.mode-description {
    color: var(--color--foreground-fg--fg-base-65);
    font-style: italic;
    text-align: center;
    padding: 12px;
    background: var(--color--background-bg--bg-gray);
    border-radius: var(--radius--8px);
    margin-top: 12px;
}

/* 参数控制 */
.parameters {
    display: grid;
    gap: 32px;
}

.param-group {
    display: grid;
    gap: 12px;
}

.param-group label {
    font-weight: 600;
    color: var(--color--foreground-fg--fg-base);
    font-size: 16px;
    font-family: Satoshi, Arial, sans-serif;
}

.param-control {
    display: flex;
    align-items: center;
    gap: 16px;
    background: var(--color--background-bg--bg-gray);
    padding: 16px;
    border-radius: var(--radius--8px);
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.param-control:hover {
    border-color: var(--color--border--accentsubtle);
    background: var(--color--border--accentminimal);
}

.param-control input[type="range"] {
    flex: 1;
    height: 6px;
    background: var(--color--border--gray-secondary);
    border-radius: 3px;
    outline: none;
    -webkit-appearance: none;
    cursor: pointer;
}

.param-control input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 20px;
    height: 20px;
    background: var(--color--accent--accent-solid);
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(207, 22, 62, 0.3);
    transition: all 0.3s ease;
}

.param-control input[type="range"]::-webkit-slider-thumb:hover {
    transform: scale(1.2);
    box-shadow: 0 4px 16px rgba(207, 22, 62, 0.5);
}

.param-control input[type="number"] {
    width: 80px;
    padding: 8px 12px;
    border: 2px solid var(--color--border--gray-secondary);
    border-radius: var(--radius--4px);
    font-size: 0.9em;
    text-align: center;
    background: white;
    transition: border-color 0.3s ease;
}

.param-control input[type="number"]:focus {
    outline: none;
    border-color: var(--color--accent--accent-solid);
}

.param-unit {
    color: var(--color--foreground-fg--fg-base-65);
    font-weight: 500;
    min-width: 40px;
}

.param-tip {
    color: var(--color--foreground-fg--fg-base-65);
    font-size: 0.9em;
    margin-top: 4px;
    font-style: italic;
}

/* 高级参数 */
.advanced-params {
    margin-top: 32px;
    border-top: 1px solid var(--color--border--gray-secondary);
    padding-top: 24px;
}

.advanced-params h4 {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
    color: var(--color--foreground-fg--fg-base);
}

.toggle-btn {
    background: var(--color--background-bg--bg-gray);
    border: none;
    padding: 8px 16px;
    border-radius: var(--radius--8px);
    cursor: pointer;
    font-size: 0.9em;
    transition: all 0.3s ease;
    font-family: Satoshi, Arial, sans-serif;
    font-weight: 500;
}

.toggle-btn:hover {
    background: var(--color--border--accentminimal);
    color: var(--color--accent--accent-solid);
}

.advanced-content {
    display: grid;
    gap: 24px;
}

/* 波形显示区域 */
.waveform-section h3 {
    font-size: 28px;
    margin-bottom: 24px;
    color: var(--color--foreground-fg--fg-base);
}

.waveform-container {
    display: grid;
    gap: 16px;
}

.waveform-controls {
    display: flex;
    align-items: center;
    gap: 16px;
    flex-wrap: wrap;
    padding: 16px;
    background: var(--color--background-bg--bg-gray);
    border-radius: var(--radius--8px);
}

.control-btn,
.tool-btn {
    padding: 12px 20px;
    border: 2px solid var(--color--border--gray-secondary);
    background: white;
    border-radius: var(--radius--8px);
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
    font-family: Satoshi, Arial, sans-serif;
}

.control-btn:hover,
.tool-btn:hover {
    border-color: var(--color--accent--accent-solid);
    background: var(--color--border--accentminimal);
    transform: translateY(-2px);
}

.control-btn.active,
.tool-btn.active {
    border-color: var(--color--accent--accent-solid);
    background: var(--color--accent--accent-solid);
    color: white;
}

.time-display {
    color: var(--color--foreground-fg--fg-base-65);
    font-weight: 600;
    margin-left: auto;
    font-family: 'Monaco', 'Menlo', monospace;
}

/* 波形画布容器 */
.waveform-canvas-container {
    position: relative;
    background: var(--color--background-bg--bg-gray);
    border: 2px solid var(--color--border--gray-secondary);
    border-radius: var(--radius--12px);
    overflow: hidden;
    box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);
}

#waveformCanvas {
    display: block;
    width: 100%;
    height: 200px;
    cursor: crosshair;
}

.threshold-line {
    position: absolute;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--color--accent--accent-solid);
    cursor: ns-resize;
    z-index: 10;
    border-radius: 2px;
    box-shadow: 0 2px 8px rgba(207, 22, 62, 0.3);
}

.threshold-line::before {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    top: -6px;
    bottom: -6px;
    background: rgba(207, 22, 62, 0.1);
    border-radius: 4px;
}

.playhead {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 2px;
    background: #22c55e;
    z-index: 5;
    pointer-events: none;
    box-shadow: 0 0 8px rgba(34, 197, 94, 0.5);
}

/* 波形工具栏 */
.waveform-toolbar {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    padding: 16px;
    background: var(--color--background-bg--bg-gray);
    border-radius: var(--radius--8px);
}

/* 片段信息 */
.segments-info {
    background: var(--color--background-bg--bg-gray);
    border-radius: var(--radius--8px);
    padding: 20px;
}

.segment-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 24px;
}

.stat {
    color: var(--color--foreground-fg--fg-base-65);
    font-size: 0.9em;
    text-align: center;
    padding: 12px;
    background: white;
    border-radius: var(--radius--8px);
    border: 2px solid var(--color--border--gray-secondary);
}

.stat strong {
    color: var(--color--foreground-fg--fg-base);
    display: block;
    font-size: 1.5em;
    margin-bottom: 4px;
    font-family: Satoshi, Arial, sans-serif;
    font-weight: 700;
}

/* 输出区域 */
.output-section h3,
.output-section h4 {
    color: var(--color--foreground-fg--fg-base);
    margin-bottom: 16px;
}

.output-section h3 {
    font-size: 28px;
    margin-bottom: 24px;
}

/* 预览区域 */
.preview-area {
    margin-bottom: 32px;
    padding: 24px;
    background: var(--color--border--accentminimal);
    border-radius: var(--radius--12px);
    border: 2px solid var(--color--border--accentsubtle);
}

.preview-area h4 {
    color: var(--color--accent--accent-solid);
    margin-bottom: 8px;
}

.preview-area p {
    color: var(--color--foreground-fg--fg-base-65);
    margin-bottom: 16px;
}

.preview-btn {
    background: var(--color--accent--accent-solid);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: var(--radius--8px);
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    font-family: Satoshi, Arial, sans-serif;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    font-size: 12px;
}

.preview-btn:hover {
    background: var(--color--accent--accent-solid-hover);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(207, 22, 62, 0.3);
}

#previewAudio {
    margin-top: 16px;
    width: 100%;
    border-radius: var(--radius--8px);
}

/* 输出设置 */
.output-settings {
    display: grid;
    gap: 20px;
    margin-bottom: 32px;
}

.setting-group {
    display: grid;
    gap: 8px;
}

.setting-group label {
    font-weight: 600;
    color: var(--color--foreground-fg--fg-base);
    font-family: Satoshi, Arial, sans-serif;
}

.setting-group select {
    padding: 12px 16px;
    border: 2px solid var(--color--border--gray-secondary);
    border-radius: var(--radius--8px);
    background: white;
    font-size: 1em;
    cursor: pointer;
    transition: all 0.3s ease;
}

.setting-group select:focus {
    outline: none;
    border-color: var(--color--accent--accent-solid);
    box-shadow: 0 0 0 3px rgba(207, 22, 62, 0.1);
}

/* 处理区域 */
.process-area {
    text-align: center;
}

.process-btn {
    background: linear-gradient(135deg, var(--color--accent--accent-solid), var(--color--accent--accent-solid-hover));
    color: white;
    border: none;
    padding: 20px 48px;
    border-radius: var(--radius--12px);
    font-size: 1.2em;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 8px 32px rgba(207, 22, 62, 0.3);
    text-transform: uppercase;
    letter-spacing: 1.5px;
    font-family: Satoshi, Arial, sans-serif;
    font-size: 14px;
}

.process-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 40px rgba(207, 22, 62, 0.4);
}

.process-btn:disabled {
    background: var(--color--foreground-fg--fg-disabled);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

/* 处理状态 */
.process-status {
    margin-top: 24px;
    padding: 24px;
    background: var(--color--background-bg--bg-gray);
    border-radius: var(--radius--12px);
    border: 2px solid var(--color--border--gray-secondary);
}

.process-progress {
    width: 100%;
    height: 12px;
    background: var(--color--border--gray-secondary);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 16px;
    position: relative;
}

.process-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--color--accent--accent-solid), var(--color--accent--accent-solid-hover));
    width: 0%;
    transition: width 0.3s ease;
    border-radius: 6px;
}

.process-text {
    font-weight: 600;
    color: var(--color--foreground-fg--fg-base);
    margin-bottom: 8px;
    font-family: Satoshi, Arial, sans-serif;
}

.process-eta {
    color: var(--color--foreground-fg--fg-base-65);
    font-size: 0.9em;
}

/* 页脚 */
.footer {
    text-align: center;
    margin-top: 48px;
    padding: 24px;
    color: var(--color--foreground-fg--fg-base-65);
    background: rgba(255, 255, 255, 0.5);
    backdrop-filter: blur(10px);
    border-radius: var(--radius--16px);
}

/* 响应式设计 */
@media (max-width: 1024px) {
    .container {
        padding: 0 20px;
    }

    .tool-header h2 {
        font-size: 40px;
    }

    .mode-buttons {
        grid-template-columns: 1fr 1fr;
    }
}

@media (max-width: 768px) {
    .container {
        padding: 0 16px;
    }

    .header {
        flex-direction: column;
        gap: 16px;
        text-align: center;
    }

    .nav {
        justify-content: center;
    }

    .tool-header h2 {
        font-size: 32px;
    }

    .tool-header {
        padding: 32px 20px;
    }

    .section {
        padding: 24px 20px;
    }

    .upload-area {
        padding: 32px 16px;
    }

    .file-details {
        flex-direction: column;
        gap: 8px;
    }

    .mode-buttons {
        grid-template-columns: 1fr;
    }

    .param-control {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
    }

    .param-control input[type="number"] {
        width: 100%;
    }

    .waveform-controls,
    .waveform-toolbar {
        flex-direction: column;
    }

    .segment-stats {
        grid-template-columns: 1fr 1fr;
        gap: 16px;
    }

    .output-settings {
        gap: 16px;
    }

    h1 {
        font-size: 44px;
    }

    h2 {
        font-size: 40px;
    }

    h3 {
        font-size: 24px;
    }
}

@media (max-width: 480px) {
    .container {
        padding: 0 12px;
    }

    .tool-header h2 {
        font-size: 28px;
    }

    .segment-stats {
        grid-template-columns: 1fr;
    }

    .waveform-controls {
        padding: 12px;
    }

    .process-btn {
        padding: 16px 32px;
        font-size: 1em;
    }

    h1 {
        font-size: 36px;
    }

    h2 {
        font-size: 32px;
    }
}

/* 动画效果 */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.config-section,
.waveform-section,
.output-section {
    animation: fadeIn 0.6s ease-out;
}

@keyframes pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}

.upload-area.dragover {
    animation: pulse 1s infinite;
}

/* 进度条动画 */
@keyframes progressShine {
    0% {
        transform: translateX(-100%);
    }
    100% {
        transform: translateX(100%);
    }
}

.process-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    animation: progressShine 2s infinite;
}

/* 工具提示样式 */
.tooltip {
    position: relative;
    cursor: help;
}

.tooltip::before {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    background: var(--color--background-bg--bg-black);
    color: white;
    padding: 8px 12px;
    border-radius: var(--radius--8px);
    font-size: 0.8em;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 1000;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
}

.tooltip:hover::before {
    opacity: 1;
}

/* 错误和成功状态 */
.error {
    border-color: #ef4444 !important;
    background: #fef2f2 !important;
}

.error-message {
    color: #dc2626;
    font-size: 0.9em;
    margin-top: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px;
    background: #fef2f2;
    border-radius: var(--radius--8px);
    border: 1px solid #fecaca;
}

.error-message::before {
    content: '⚠️';
}

.success {
    border-color: #10b981 !important;
    background: #f0fdf4 !important;
}

.success-message {
    color: #059669;
    font-size: 0.9em;
    margin-top: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px;
    background: #f0fdf4;
    border-radius: var(--radius--8px);
    border: 1px solid #dcfce7;
}

.success-message::before {
    content: '✅';
}

/* 焦点样式 */
*:focus {
    outline: 2px solid var(--color--accent--accent-solid);
    outline-offset: 2px;
}

/* 选择文本样式 */
::selection {
    background: var(--color--border--accentsubtle);
    color: var(--color--accent--accent-solid);
}

/* 滚动条样式 */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: var(--color--background-bg--bg-gray);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: var(--color--border--neutralbold);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--color--accent--accent-solid);
}
    </style>
</head>
<body>
    <div class="container">
        <!-- 头部导航 -->
        <header class="header">
            <div class="logo">
                <h1>自媒体工具集</h1>
                <p>提升创作效率的智能工具</p>
            </div>
            <nav class="nav">
                <span class="nav-item active">静音片段过滤</span>
                <span class="nav-item disabled">更多工具</span>
            </nav>
        </header>

        <!-- 主内容区域 -->
        <main class="main">
            <!-- 工具标题区 -->
            <section class="tool-header">
                <h2>静音片段过滤工具</h2>
                <p>智能识别并去除视频中的静音片段，提升剪辑效率</p>
                <p>本网页仅做原型展示，由于是使用python语言实现，目前还不支持浏览器访问，完整的python脚本在： 
                    <a href="https://github.com/samelltiger/taoge_media_edit" target="_blank">Github仓库地址</a>
                </p>
            </section>

            <!-- 文件上传区域 -->
            <section class="upload-section">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">📁</div>
                    <h3>拖拽文件到此处或点击上传</h3>
                    <p>支持格式：MP4, MOV, MP3, WAV, M4A</p>
                    <input type="file" id="fileInput" accept=".mp4,.mov,.mp3,.wav,.m4a" hidden>
                    <button class="upload-btn" onclick="document.getElementById('fileInput').click()">选择文件</button>
                </div>

                <!-- 文件信息显示 -->
                <div class="file-info" id="fileInfo" style="display: none;">
                    <div class="file-details">
                        <span class="file-name" id="fileName"></span>
                        <span class="file-size" id="fileSize"></span>
                        <span class="file-duration" id="fileDuration"></span>
                    </div>
                    <div class="upload-progress">
                        <div class="progress-bar" id="progressBar"></div>
                        <span class="progress-text" id="progressText">0%</span>
                    </div>
                </div>
            </section>

            <!-- 参数配置区域 -->
            <section class="config-section" id="configSection" style="display: none;">
                <h3>参数配置</h3>

                <!-- 预设档位 -->
                <div class="preset-modes">
                    <h4>节奏模式预设</h4>
                    <div class="mode-buttons">
                        <button class="mode-btn" data-mode="slow">慢速节奏</button>
                        <button class="mode-btn active" data-mode="medium">中等节奏</button>
                        <button class="mode-btn" data-mode="fast">快速节奏</button>
                        <button class="mode-btn" data-mode="custom">自定义</button>
                    </div>
                    <div class="mode-description">
                        <p id="modeDesc">适用于大多数标准口播视频</p>
                    </div>
                </div>

                <!-- 核心参数 -->
                <div class="parameters">
                    <div class="param-group">
                        <label for="silenceThreshold">静音阈值 (dB)</label>
                        <div class="param-control">
                            <input type="range" id="silenceThreshold" min="-60" max="-20" value="-40" step="1">
                            <input type="number" id="silenceThresholdValue" min="-60" max="-20" value="-40">
                            <span class="param-unit">dB</span>
                        </div>
                        <p class="param-tip">低于此音量值的片段将被判定为静音</p>
                    </div>

                    <div class="param-group">
                        <label for="leadingPadding">前过渡保留 (秒)</label>
                        <div class="param-control">
                            <input type="range" id="leadingPadding" min="0" max="2" value="0.3" step="0.1">
                            <input type="number" id="leadingPaddingValue" min="0" max="2" value="0.3" step="0.1">
                            <span class="param-unit">秒</span>
                        </div>
                        <p class="param-tip">在有用片段开始处额外保留的时间</p>
                    </div>

                    <div class="param-group">
                        <label for="trailingPadding">后过渡保留 (秒)</label>
                        <div class="param-control">
                            <input type="range" id="trailingPadding" min="0" max="2" value="0.5" step="0.1">
                            <input type="number" id="trailingPaddingValue" min="0" max="2" value="0.5" step="0.1">
                            <span class="param-unit">秒</span>
                        </div>
                        <p class="param-tip">在有用片段结束处额外保留的时间</p>
                    </div>
                </div>

                <!-- 高级参数 -->
                <div class="advanced-params" id="advancedParams">
                    <h4>高级参数 <button class="toggle-btn" id="toggleAdvanced">展开</button></h4>
                    <div class="advanced-content" style="display: none;">
                        <div class="param-group">
                            <label for="minSilenceDuration">最小静音时长 (秒)</label>
                            <div class="param-control">
                                <input type="range" id="minSilenceDuration" min="0.1" max="2" value="0.3" step="0.1">
                                <input type="number" id="minSilenceDurationValue" min="0.1" max="2" value="0.3" step="0.1">
                                <span class="param-unit">秒</span>
                            </div>
                            <p class="param-tip">短于此时长的静音片段将被忽略</p>
                        </div>

                        <div class="param-group">
                            <label for="minVoiceDuration">最小人声时长 (秒)</label>
                            <div class="param-control">
                                <input type="range" id="minVoiceDuration" min="0.1" max="2" value="0.5" step="0.1">
                                <input type="number" id="minVoiceDurationValue" min="0.1" max="2" value="0.5" step="0.1">
                                <span class="param-unit">秒</span>
                            </div>
                            <p class="param-tip">短于此时长的人声片段将被忽略</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 音频波形显示区域 -->
            <section class="waveform-section" id="waveformSection" style="display: none;">
                <h3>音频波形分析</h3>
                <div class="waveform-container">
                    <div class="waveform-controls">
                        <button class="control-btn" id="samplingBtn">🎯 采样工具</button>
                        <button class="control-btn" id="playBtn">▶️ 播放</button>
                        <button class="control-btn" id="pauseBtn" style="display: none;">⏸️ 暂停</button>
                        <span class="time-display" id="timeDisplay">00:00 / 00:00</span>
                    </div>

                    <!-- 波形图区域 -->
                    <div class="waveform-canvas-container">
                        <canvas id="waveformCanvas" width="800" height="200"></canvas>
                        <div class="threshold-line" id="thresholdLine"></div>
                        <div class="playhead" id="playhead"></div>
                    </div>

                    <!-- 波形图工具栏 -->
                    <div class="waveform-toolbar">
                        <button class="tool-btn" id="cutTool">✂️ 切割</button>
                        <button class="tool-btn" id="mergeTool">🔗 合并</button>
                        <button class="tool-btn" id="deleteTool">🗑️ 删除</button>
                        <button class="tool-btn" id="undoBtn">↶ 撤销</button>
                        <button class="tool-btn" id="redoBtn">↷ 重做</button>
                    </div>

                    <!-- 片段信息 -->
                    <div class="segments-info">
                        <div class="segment-stats">
                            <span class="stat">有用片段: <strong id="validSegments">0</strong></span>
                            <span class="stat">静音片段: <strong id="silentSegments">0</strong></span>
                            <span class="stat">总时长: <strong id="totalDuration">00:00</strong></span>
                            <span class="stat">保留时长: <strong id="keepDuration">00:00</strong></span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 预览和输出区域 -->
            <section class="output-section" id="outputSection" style="display: none;">
                <h3>预览与输出</h3>

                <!-- 预览功能 -->
                <div class="preview-area">
                    <h4>效果预览</h4>
                    <p>播放30秒典型片段，确认处理效果</p>
                    <button class="preview-btn" id="previewBtn">🎵 生成预览</button>
                    <audio id="previewAudio" controls style="display: none;"></audio>
                </div>

                <!-- 输出设置 -->
                <div class="output-settings">
                    <h4>输出设置</h4>

                    <div class="setting-group">
                        <label>输出格式</label>
                        <select id="outputFormat">
                            <option value="mp4">视频 (MP4)</option>
                            <option value="mp3">音频 (MP3)</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <label>输出质量</label>
                        <select id="outputQuality">
                            <option value="high">高质量</option>
                            <option value="medium" selected>中等质量</option>
                            <option value="low">快速压缩</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <label>输出方式</label>
                        <select id="outputMethod">
                            <option value="download">直接下载文件</option>
                            <option value="premiere">生成 Premiere Pro XML</option>
                            <option value="finalcut">生成 Final Cut Pro XML</option>
                        </select>
                    </div>
                </div>

                <!-- 处理按钮 -->
                <div class="process-area">
                    <button class="process-btn" id="processBtn">🚀 开始处理</button>
                    <div class="process-status" id="processStatus" style="display: none;">
                        <div class="process-progress">
                            <div class="process-bar" id="processBar"></div>
                        </div>
                        <p class="process-text" id="processText">正在处理中...</p>
                        <p class="process-eta" id="processEta">预计完成时间: 2分钟</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- 页脚 -->
        <footer class="footer">
            <p>&copy; 2024 自媒体工具集 - 专为创作者打造的效率工具</p>
        </footer>
    </div>

    <script>
        // 全局变量
let uploadedFile = null;
let audioContext = null;
let audioBuffer = null;
let waveformData = null;
let silenceSegments = [];
let voiceSegments = [];

// DOM 元素
const uploadArea = document.getElementById('uploadArea');
const fileInput = document.getElementById('fileInput');
const fileInfo = document.getElementById('fileInfo');
const configSection = document.getElementById('configSection');
const waveformSection = document.getElementById('waveformSection');
const outputSection = document.getElementById('outputSection');

// 预设参数
const presets = {
    slow: { threshold: -50, leading: 0.5, trailing: 0.8, desc: '适用于访谈、播客等停顿较多的场景' },
    medium: { threshold: -40, leading: 0.3, trailing: 0.5, desc: '适用于大多数标准口播视频' },
    fast: { threshold: -35, leading: 0.2, trailing: 0.3, desc: '适用于信息密集、语速快的短视频' },
    custom: { threshold: -40, leading: 0.3, trailing: 0.5, desc: '自定义参数设置' }
};

// 初始化
document.addEventListener('DOMContentLoaded', function() {
    initializeEventListeners();
    initializePresets();
    initializeParameterSync();
    initializeAdvancedToggle();
});

// 初始化事件监听器
function initializeEventListeners() {
    // 文件上传相关
    uploadArea.addEventListener('click', () => fileInput.click());
    uploadArea.addEventListener('dragover', handleDragOver);
    uploadArea.addEventListener('dragleave', handleDragLeave);
    uploadArea.addEventListener('drop', handleFileDrop);
    fileInput.addEventListener('change', handleFileSelect);

    // 波形相关
    const samplingBtn = document.getElementById('samplingBtn');
    const playBtn = document.getElementById('playBtn');
    const pauseBtn = document.getElementById('pauseBtn');

    samplingBtn?.addEventListener('click', toggleSamplingMode);
    playBtn?.addEventListener('click', playAudio);
    pauseBtn?.addEventListener('click', pauseAudio);

    // 处理相关
    const previewBtn = document.getElementById('previewBtn');
    const processBtn = document.getElementById('processBtn');

    previewBtn?.addEventListener('click', generatePreview);
    processBtn?.addEventListener('click', startProcessing);
}

// 初始化预设
function initializePresets() {
    const modeButtons = document.querySelectorAll('.mode-btn');
    const modeDesc = document.getElementById('modeDesc');

    modeButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            // 移除所有active类
            modeButtons.forEach(b => b.classList.remove('active'));
            // 添加active类到当前按钮
            btn.classList.add('active');

            const mode = btn.dataset.mode;
            const preset = presets[mode];

            if (preset) {
                // 更新描述
                modeDesc.textContent = preset.desc;

                // 更新参数（除非是自定义模式）
                if (mode !== 'custom') {
                    updateParameters(preset);
                }
            }
        });
    });
}

// 更新参数
function updateParameters(preset) {
    const silenceThreshold = document.getElementById('silenceThreshold');
    const silenceThresholdValue = document.getElementById('silenceThresholdValue');
    const leadingPadding = document.getElementById('leadingPadding');
    const leadingPaddingValue = document.getElementById('leadingPaddingValue');
    const trailingPadding = document.getElementById('trailingPadding');
    const trailingPaddingValue = document.getElementById('trailingPaddingValue');

    if (silenceThreshold && silenceThresholdValue) {
        silenceThreshold.value = preset.threshold;
        silenceThresholdValue.value = preset.threshold;
    }
    if (leadingPadding && leadingPaddingValue) {
        leadingPadding.value = preset.leading;
        leadingPaddingValue.value = preset.leading;
    }
    if (trailingPadding && trailingPaddingValue) {
        trailingPadding.value = preset.trailing;
        trailingPaddingValue.value = preset.trailing;
    }

    // 更新阈值线位置
    updateThresholdLine();
}

// 初始化参数同步
function initializeParameterSync() {
    const params = [
        'silenceThreshold',
        'leadingPadding',
        'trailingPadding',
        'minSilenceDuration',
        'minVoiceDuration'
    ];

    params.forEach(param => {
        const slider = document.getElementById(param);
        const input = document.getElementById(param + 'Value');

        if (slider && input) {
            slider.addEventListener('input', (e) => {
                input.value = e.target.value;
                if (param === 'silenceThreshold') {
                    updateThresholdLine();
                }
                // 切换到自定义模式
                switchToCustomMode();
            });

            input.addEventListener('input', (e) => {
                slider.value = e.target.value;
                if (param === 'silenceThreshold') {
                    updateThresholdLine();
                }
                // 切换到自定义模式
                switchToCustomMode();
            });
        }
    });
}

// 切换到自定义模式
function switchToCustomMode() {
    const customBtn = document.querySelector('.mode-btn[data-mode="custom"]');
    const modeButtons = document.querySelectorAll('.mode-btn');
    const modeDesc = document.getElementById('modeDesc');

    if (customBtn) {
        modeButtons.forEach(btn => btn.classList.remove('active'));
        customBtn.classList.add('active');
        modeDesc.textContent = presets.custom.desc;
    }
}

// 初始化高级参数切换
function initializeAdvancedToggle() {
    const toggleBtn = document.getElementById('toggleAdvanced');
    const advancedContent = document.querySelector('.advanced-content');

    if (toggleBtn && advancedContent) {
        toggleBtn.addEventListener('click', () => {
            const isVisible = advancedContent.style.display !== 'none';
            advancedContent.style.display = isVisible ? 'none' : 'grid';
            toggleBtn.textContent = isVisible ? '展开' : '收起';
        });
    }
}

// 拖拽处理
function handleDragOver(e) {
    e.preventDefault();
    uploadArea.classList.add('dragover');
}

function handleDragLeave(e) {
    e.preventDefault();
    uploadArea.classList.remove('dragover');
}

function handleFileDrop(e) {
    e.preventDefault();
    uploadArea.classList.remove('dragover');

    const files = e.dataTransfer.files;
    if (files.length > 0) {
        handleFile(files[0]);
    }
}

// 文件选择处理
function handleFileSelect(e) {
    const file = e.target.files[0];
    if (file) {
        handleFile(file);
    }
}

// 处理文件
function handleFile(file) {
    // 验证文件类型
    const validTypes = ['audio/mpeg', 'audio/wav', 'audio/mp4', 'video/mp4', 'video/quicktime'];
    const validExtensions = ['.mp3', '.wav', '.m4a', '.mp4', '.mov'];

    const isValidType = validTypes.some(type => file.type.includes(type));
    const isValidExtension = validExtensions.some(ext => file.name.toLowerCase().endsWith(ext));

    if (!isValidType && !isValidExtension) {
        showError('不支持的文件格式，请选择 MP4, MOV, MP3, WAV, M4A 格式的文件');
        return;
    }

    uploadedFile = file;
    showFileInfo(file);
    simulateUpload();
}

// 显示文件信息
function showFileInfo(file) {
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const fileDuration = document.getElementById('fileDuration');

    if (fileName) fileName.textContent = file.name;
    if (fileSize) fileSize.textContent = formatFileSize(file.size);
    if (fileDuration) fileDuration.textContent = '正在分析...';

    fileInfo.style.display = 'block';
}

// 格式化文件大小
function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// 模拟上传进度
function simulateUpload() {
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');

    let progress = 0;
    const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress >= 100) {
            progress = 100;
            clearInterval(interval);
            setTimeout(() => {
                onUploadComplete();
            }, 500);
        }

        if (progressBar) progressBar.style.width = progress + '%';
        if (progressText) progressText.textContent = Math.round(progress) + '%';
    }, 200);
}

// 上传完成
function onUploadComplete() {
    const fileDuration = document.getElementById('fileDuration');
    if (fileDuration) {
        // 模拟音频时长
        const duration = Math.floor(Math.random() * 3600 + 300); // 5-65分钟
        fileDuration.textContent = formatDuration(duration);
    }

    // 显示配置区域
    configSection.style.display = 'block';

    // 模拟音频分析
    setTimeout(() => {
        analyzeAudio();
    }, 1000);
}

// 格式化时长
function formatDuration(seconds) {
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;

    if (hours > 0) {
        return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    } else {
        return `${minutes}:${secs.toString().padStart(2, '0')}`;
    }
}

// 分析音频
function analyzeAudio() {
    // 模拟音频分析过程
    showSuccess('音频分析完成，正在生成波形图...');

    setTimeout(() => {
        generateWaveform();
        waveformSection.style.display = 'block';
        outputSection.style.display = 'block';
    }, 1500);
}

// 生成波形图
function generateWaveform() {
    const canvas = document.getElementById('waveformCanvas');
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    const width = canvas.width = canvas.offsetWidth;
    const height = canvas.height = 200;

    // 生成模拟波形数据
    generateMockWaveformData(width);

    // 绘制波形
    drawWaveform(ctx, width, height);

    // 更新统计信息
    updateSegmentStats();

    // 初始化阈值线
    updateThresholdLine();
}

// 生成模拟波形数据
function generateMockWaveformData(width) {
    waveformData = [];
    silenceSegments = [];
    voiceSegments = [];

    const threshold = parseFloat(document.getElementById('silenceThreshold')?.value || -40);

    for (let i = 0; i < width; i++) {
        // 生成带有静音片段的模拟音频数据
        let amplitude;
        if (Math.random() < 0.3) { // 30%概率为静音
            amplitude = Math.random() * 0.1 - 0.8; // -0.8 到 -0.7 (静音)
        } else {
            amplitude = Math.random() * 0.6 - 0.3; // -0.3 到 0.3 (有声)
        }

        waveformData.push(amplitude);
    }

    // 分析片段
    analyzeSegments(threshold);
}

// 分析片段
function analyzeSegments(threshold) {
    if (!waveformData) return;

    silenceSegments = [];
    voiceSegments = [];

    let currentSegmentStart = 0;
    let currentSegmentType = null; // 'silence' or 'voice'

    const thresholdNormalized = (threshold + 60) / 60; // 转换到0-1范围

    for (let i = 0; i < waveformData.length; i++) {
        const amplitude = Math.abs(waveformData[i]);
        const isVoice = amplitude > Math.abs(thresholdNormalized);
        const segmentType = isVoice ? 'voice' : 'silence';

        if (currentSegmentType === null) {
            currentSegmentType = segmentType;
            currentSegmentStart = i;
        } else if (currentSegmentType !== segmentType) {
            // 保存当前片段
            const segment = {
                start: currentSegmentStart,
                end: i - 1,
                type: currentSegmentType
            };

            if (currentSegmentType === 'silence') {
                silenceSegments.push(segment);
            } else {
                voiceSegments.push(segment);
            }

            // 开始新片段
            currentSegmentType = segmentType;
            currentSegmentStart = i;
        }
    }

    // 保存最后一个片段
    if (currentSegmentType) {
        const segment = {
            start: currentSegmentStart,
            end: waveformData.length - 1,
            type: currentSegmentType
        };

        if (currentSegmentType === 'silence') {
            silenceSegments.push(segment);
        } else {
            voiceSegments.push(segment);
        }
    }
}

// 绘制波形
function drawWaveform(ctx, width, height) {
    if (!waveformData) return;

    ctx.clearRect(0, 0, width, height);

    const centerY = height / 2;
    const maxAmplitude = Math.max(...waveformData.map(Math.abs));

    // 绘制背景
    ctx.fillStyle = '#f8fafc';
    ctx.fillRect(0, 0, width, height);

    // 绘制中心线
    ctx.strokeStyle = '#e2e8f0';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(0, centerY);
    ctx.lineTo(width, centerY);
    ctx.stroke();

    // 绘制波形
    for (let i = 0; i < waveformData.length; i++) {
        const amplitude = waveformData[i];
        const normalizedAmplitude = (amplitude / maxAmplitude) * (centerY - 10);

        // 根据片段类型选择颜色
        const isInSilenceSegment = silenceSegments.some(seg => i >= seg.start && i <= seg.end);
        ctx.fillStyle = isInSilenceSegment ? '#9ca3af' : '#3b82f6';

        const barHeight = Math.abs(normalizedAmplitude);
        const x = i;
        const y = centerY - barHeight / 2;

        ctx.fillRect(x, y, 1, barHeight);
    }
}

// 更新阈值线
function updateThresholdLine() {
    const thresholdLine = document.getElementById('thresholdLine');
    const canvas = document.getElementById('waveformCanvas');
    const threshold = parseFloat(document.getElementById('silenceThreshold')?.value || -40);

    if (thresholdLine && canvas) {
        // 将dB值转换为画布位置
        const normalizedThreshold = (threshold + 60) / 60; // -60dB 到 0dB 映射到 0-1
        const position = canvas.offsetHeight * (1 - normalizedThreshold);

        thresholdLine.style.top = position + 'px';

        // 重新分析片段
        if (waveformData) {
            analyzeSegments(threshold);
            const ctx = canvas.getContext('2d');
            drawWaveform(ctx, canvas.offsetWidth, canvas.offsetHeight);
            updateSegmentStats();
        }
    }
}

// 更新片段统计
function updateSegmentStats() {
    const validSegmentsEl = document.getElementById('validSegments');
    const silentSegmentsEl = document.getElementById('silentSegments');
    const totalDurationEl = document.getElementById('totalDuration');
    const keepDurationEl = document.getElementById('keepDuration');

    if (validSegmentsEl) validSegmentsEl.textContent = voiceSegments.length;
    if (silentSegmentsEl) silentSegmentsEl.textContent = silenceSegments.length;
    if (totalDurationEl) totalDurationEl.textContent = '45:32'; // 模拟总时长
    if (keepDurationEl) keepDurationEl.textContent = '38:45'; // 模拟保留时长
}

// 采样模式
let samplingMode = false;

function toggleSamplingMode() {
    const samplingBtn = document.getElementById('samplingBtn');
    samplingMode = !samplingMode;

    if (samplingMode) {
        samplingBtn.classList.add('active');
        samplingBtn.textContent = '🎯 点击波形采样';
        // 添加画布点击事件
        const canvas = document.getElementById('waveformCanvas');
        if (canvas) {
            canvas.style.cursor = 'crosshair';
            canvas.addEventListener('click', handleWaveformSampling);
        }
    } else {
        samplingBtn.classList.remove('active');
        samplingBtn.textContent = '🎯 采样工具';
        // 移除画布点击事件
        const canvas = document.getElementById('waveformCanvas');
        if (canvas) {
            canvas.style.cursor = 'default';
            canvas.removeEventListener('click', handleWaveformSampling);
        }
    }
}

// 处理波形采样
function handleWaveformSampling(e) {
    if (!samplingMode || !waveformData) return;

    const canvas = e.target;
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    // 将画布坐标转换为数据索引
    const dataIndex = Math.floor((x / canvas.offsetWidth) * waveformData.length);

    if (dataIndex >= 0 && dataIndex < waveformData.length) {
        const amplitude = Math.abs(waveformData[dataIndex]);
        // 将幅度转换为dB值（模拟）
        const dbValue = Math.round((amplitude * 60) - 60);

        // 更新阈值参数
        const silenceThreshold = document.getElementById('silenceThreshold');
        const silenceThresholdValue = document.getElementById('silenceThresholdValue');

        if (silenceThreshold && silenceThresholdValue) {
            silenceThreshold.value = dbValue;
            silenceThresholdValue.value = dbValue;
        }

        // 切换到自定义模式
        switchToCustomMode();

        // 更新阈值线
        updateThresholdLine();

        // 退出采样模式
        toggleSamplingMode();

        showSuccess(`已设置静音阈值为 ${dbValue} dB`);
    }
}

// 播放控制
function playAudio() {
    const playBtn = document.getElementById('playBtn');
    const pauseBtn = document.getElementById('pauseBtn');

    if (playBtn) playBtn.style.display = 'none';
    if (pauseBtn) pauseBtn.style.display = 'inline-block';

    // 模拟播放
    showSuccess('开始播放音频');
}

function pauseAudio() {
    const playBtn = document.getElementById('playBtn');
    const pauseBtn = document.getElementById('pauseBtn');

    if (playBtn) playBtn.style.display = 'inline-block';
    if (pauseBtn) pauseBtn.style.display = 'none';

    showSuccess('暂停播放');
}

// 生成预览
function generatePreview() {
    const previewAudio = document.getElementById('previewAudio');
    const previewBtn = document.getElementById('previewBtn');

    if (previewBtn) previewBtn.textContent = '🔄 正在生成预览...';

    setTimeout(() => {
        if (previewBtn) previewBtn.textContent = '🎵 生成预览';
        if (previewAudio) {
            previewAudio.style.display = 'block';
            // 在实际应用中，这里会设置处理后的音频预览
            showSuccess('预览生成完成，请播放查看效果');
        }
    }, 2000);
}

// 开始处理
function startProcessing() {
    const processBtn = document.getElementById('processBtn');
    const processStatus = document.getElementById('processStatus');
    const processBar = document.getElementById('processBar');
    const processText = document.getElementById('processText');

    if (processBtn) {
        processBtn.textContent = '🔄 处理中...';
        processBtn.disabled = true;
    }

    if (processStatus) processStatus.style.display = 'block';

    // 模拟处理进度
    let progress = 0;
    const interval = setInterval(() => {
        progress += Math.random() * 5;
        if (progress >= 100) {
            progress = 100;
            clearInterval(interval);
            setTimeout(() => {
                onProcessingComplete();
            }, 500);
        }

        if (processBar) processBar.style.width = progress + '%';
        if (processText) {
            if (progress < 30) {
                processText.textContent = '正在分析音频...';
            } else if (progress < 70) {
                processText.textContent = '正在处理静音片段...';
            } else if (progress < 95) {
                processText.textContent = '正在生成输出文件...';
            } else {
                processText.textContent = '处理完成！';
            }
        }
    }, 300);
}

// 处理完成
function onProcessingComplete() {
    const processBtn = document.getElementById('processBtn');
    const processText = document.getElementById('processText');

    if (processBtn) {
        processBtn.textContent = '📥 下载处理后的文件';
        processBtn.disabled = false;
        processBtn.onclick = downloadFile;
    }

    if (processText) {
        processText.textContent = '处理完成！点击下载文件';
    }

    showSuccess('文件处理完成！');
}

// 下载文件
function downloadFile() {
    const outputFormat = document.getElementById('outputFormat')?.value || 'mp4';
    const outputMethod = document.getElementById('outputMethod')?.value || 'download';

    let fileName = 'processed_audio';
    let fileType = 'video/mp4';

    switch (outputMethod) {
        case 'premiere':
            fileName += '_premiere.xml';
            fileType = 'application/xml';
            break;
        case 'finalcut':
            fileName += '_finalcut.fcpxml';
            fileType = 'application/xml';
            break;
        default:
            fileName += outputFormat === 'mp3' ? '.mp3' : '.mp4';
            fileType = outputFormat === 'mp3' ? 'audio/mpeg' : 'video/mp4';
    }

    // 模拟文件下载
    const blob = new Blob(['模拟文件内容'], { type: fileType });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = fileName;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    showSuccess(`已下载 ${fileName}`);
}

// 显示错误信息
function showError(message) {
    const errorDiv = document.createElement('div');
    errorDiv.className = 'error-message';
    errorDiv.textContent = message;
    errorDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #fef2f2;
        color: #dc2626;
        padding: 16px 24px;
        border-radius: 8px;
        border: 1px solid #fecaca;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        max-width: 400px;
    `;

    document.body.appendChild(errorDiv);

    setTimeout(() => {
        if (errorDiv.parentNode) {
            errorDiv.parentNode.removeChild(errorDiv);
        }
    }, 5000);
}

// 显示成功信息
function showSuccess(message) {
    const successDiv = document.createElement('div');
    successDiv.className = 'success-message';
    successDiv.textContent = message;
    successDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #f0fdf4;
        color: #059669;
        padding: 16px 24px;
        border-radius: 8px;
        border: 1px solid #dcfce7;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        max-width: 400px;
    `;

    document.body.appendChild(successDiv);

    setTimeout(() => {
        if (successDiv.parentNode) {
            successDiv.parentNode.removeChild(successDiv);
        }
    }, 3000);
}

// 窗口大小调整处理
window.addEventListener('resize', () => {
    setTimeout(() => {
        const canvas = document.getElementById('waveformCanvas');
        if (canvas && waveformData) {
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = 200;
            drawWaveform(ctx, width, height);
            updateThresholdLine();
        }
    }, 100);
});
    </script>
</body>
</html>